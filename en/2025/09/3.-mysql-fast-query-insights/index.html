<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[MySQL] 1. MySQL Fast Query Insights - GoodyHao's Blog</title><meta name=Description content="Elegance Never Fades"><meta property="og:url" content="https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/"><meta property="og:site_name" content="GoodyHao's Blog"><meta property="og:title" content="[MySQL] 1. MySQL Fast Query Insights"><meta property="og:description" content="[MySQL] 1. MySQL Fast Query Insights Preface Let’s start with some of the most common optimization measures we use in daily learning and business scenarios
Do more things in the same unit of time
QuickSort uses the binary search idea to sort multiple arrays within a single loop
Query less information in total
KMP algorithm preprocesses the main string to reduce the number of matches. This is the power of logic"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-21T23:11:17+08:00"><meta property="article:modified_time" content="2025-10-02T13:51:49+08:00"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="Index"><meta property="article:tag" content="Database"><meta property="article:tag" content="Optimization"><meta property="og:image" content="https://gooddayday.github.io/logo.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gooddayday.github.io/logo.jpg"><meta name=twitter:title content="[MySQL] 1. MySQL Fast Query Insights"><meta name=twitter:description content="[MySQL] 1. MySQL Fast Query Insights Preface Let’s start with some of the most common optimization measures we use in daily learning and business scenarios
Do more things in the same unit of time
QuickSort uses the binary search idea to sort multiple arrays within a single loop
Query less information in total
KMP algorithm preprocesses the main string to reduce the number of matches. This is the power of logic"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/><link rel=prev href=https://gooddayday.github.io/en/2025/09/2.-file-transfer-optimization/><link rel=next href=https://gooddayday.github.io/en/2025/09/4.-lombok/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[MySQL] 1. MySQL Fast Query Insights","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/gooddayday.github.io\/en\/2025\/09\/3.-mysql-fast-query-insights\/"},"image":["https:\/\/gooddayday.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"MySQL, index, database, optimization","wordcount":3485,"url":"https:\/\/gooddayday.github.io\/en\/2025\/09\/3.-mysql-fast-query-insights\/","datePublished":"2025-09-21T23:11:17+08:00","dateModified":"2025-10-02T13:51:49+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/gooddayday.github.io\/images\/logo.jpg"},"author":{"@type":"Person","name":"GoodyHao"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/en/ title="GoodyHao's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Elegance Never Fades</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/en/posts/>Posts </a><a class=menu-item href=/en/tags/>Tags </a><a class=menu-item href=/en/categories/>Categories </a><a class=menu-item href=/en/categories/documentation/>Docs </a><a class=menu-item href=/en/about/>About </a><a class=menu-item href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a class=menu-item href=/zh-cn/2025/09/3.-mysql-fast-query-insights/ title=简体中文>中文</a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/en/ title="GoodyHao's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Elegance Never Fades</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/en/posts/ title>Posts</a><a class=menu-item href=/en/tags/ title>Tags</a><a class=menu-item href=/en/categories/ title>Categories</a><a class=menu-item href=/en/categories/documentation/ title>Docs</a><a class=menu-item href=/en/about/ title>About</a><a class=menu-item href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a class=menu-item href=/zh-cn/2025/09/3.-mysql-fast-query-insights/ title=简体中文>中文</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[MySQL] 1. MySQL Fast Query Insights</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/en/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>GoodyHao</a></span>&nbsp;<span class=post-category>included in <a href=/en/categories/mysql/><i class="far fa-folder fa-fw" aria-hidden=true></i>MySQL</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-09-21>2025-09-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3485 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;17 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#preface>Preface</a></li><li><a href=#does-not-having-an-index-always-mean-slow-queries>Does Not Having an Index Always Mean Slow Queries?</a></li><li><a href=#indexes>Indexes</a><ul><li><a href=#b-tree-indexes>B+ Tree Indexes</a><ul><li><a href=#why-b-trees>Why B+ Trees</a></li></ul></li><li><a href=#b-tree-composite-indexes>B+ Tree Composite Indexes</a><ul><li><a href=#what-is-table-lookup>What is Table Lookup?</a></li></ul></li></ul></li><li><a href=#in-or-exists>IN or EXISTS?</a><ul><li><a href=#analysis>Analysis</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=mysql-1-mysql-fast-query-insights>[MySQL] 1. MySQL Fast Query Insights</h1><h2 id=preface>Preface</h2><ul><li><p>Let&rsquo;s start with some of the most common optimization measures we use in daily learning and business scenarios</p><ol><li><p>Do more things in the same unit of time</p><ul><li><p>QuickSort uses the binary search idea to sort multiple arrays within a single loop</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg title="1. QuickSort.jpg"></p></li></ul></li><li><p>Query less information in total</p><ul><li><p>KMP algorithm preprocesses the main string to reduce the number of matches. This is the power of logic</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg title="2. KMP.jpg"></p></li><li><p>Search trees use binary search ideas to filter half of the remaining data each time to improve efficiency. This is the power of data structures</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp title="3. Search Tree.webp"></p></li></ul></li></ol></li><li><p>For MySQL fast queries, the most critical core is to query less data - the less, the faster. This entire article revolves around this statement.</p></li></ul><h2 id=does-not-having-an-index-always-mean-slow-queries>Does Not Having an Index Always Mean Slow Queries?</h2><ul><li>Define data insertion function</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>      </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;User ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>biz_id</span><span class=w>  </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Business ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Business information&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>updated</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;User&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=k>IN</span><span class=w> </span><span class=n>start_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>end_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>bizId</span><span class=w> </span><span class=nb>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>start_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WHILE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>end_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>DO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>biz_id</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>bizId</span><span class=p>,</span><span class=w> </span><span class=k>SUBSTRING</span><span class=p>(</span><span class=n>MD5</span><span class=p>(</span><span class=n>RAND</span><span class=p>()),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>Prepare some data, where bizId = 1 has only two records, the first and last data</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=c1>-- Insert first business id 1 data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Insert one million other data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1000000</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Insert second business id 1 data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=mi>1000001</span><span class=p>,</span><span class=w> </span><span class=mi>1000001</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>Looking at the data distribution, I think everyone already knows what I want to express. Even without using indexes, we have scenarios for fast queries here.</li></ul><p><strong>Query limit 1</strong></p><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 1;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ALL</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>997030</td><td style=text-align:left>10</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>10</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span><span class=mi>43</span><span class=p>]</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>97</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>92</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>10</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=mi>199</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=mi>172</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>27</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 2;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ALL</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>997030</td><td style=text-align:left>10</td><td style=text-align:left>Using where</td></tr></tbody></table><ul><li>From a practical perspective, we can see that the execution time difference between limit 1 and limit 2 is huge.</li><li>Here&rsquo;s a tip: we can use ChatGPT to efficiently organize and analyze explain results.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(Wenxin Yiyan)
</span></span><span class=line><span class=cl>This query plan shows a full scan of the user table without using indexes, and the WHERE clause is used to filter results.
</span></span><span class=line><span class=cl>If the table is large or query performance is poor, this may cause performance issues.
</span></span><span class=line><span class=cl>Optimization may need to consider using appropriate indexes to improve query performance.
</span></span></code></pre></td></tr></table></div></div><ul><li>We can see that the execution plans for limit 1 and limit 2 are almost identical. This confirms that although the time difference is huge, the execution logic is the same for MySQL. So why is there such a huge difference? We need to analyze this specifically.</li><li>In the limit 1 scenario, based on a full table scan, it returns immediately when the first data is found. This is equivalent to querying only one record.</li><li>In the limit 2 scenario, the second data is after one million records, so according to the execution plan, it must scan the entire table to completely find the data.</li><li>In summary, does not having an index always mean slow queries? Not necessarily. Indexes only reduce the amount of data queried, but when the data volume is already extremely small, it won&rsquo;t be slower.</li></ul><h2 id=indexes>Indexes</h2><ul><li>The explain shows &ldquo;Using where&rdquo;, and according to ChatGPT&rsquo;s response and our own analysis, we can naturally think of using indexes to optimize queries. Let&rsquo;s try using B+ tree indexes.</li></ul><h3 id=b-tree-indexes>B+ Tree Indexes</h3><blockquote><p><a href=https://www.cs.usfca.edu/~galles/visualization/Algorithms.html target=_blank rel="noopener noreffer">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 1;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>2</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>21</span><span class=p>:</span><span class=mi>09</span><span class=p>:</span><span class=mi>37</span><span class=p>]</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>44</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 2;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>2</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>21</span><span class=p>:</span><span class=mi>09</span><span class=p>:</span><span class=mi>04</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>44</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>As you can see, after adding an index, query time was greatly optimized. The execution plan evolved from &ldquo;Using where&rdquo; to using &ldquo;const&rdquo;</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>Wenxin</span> <span class=n>Yiyan</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>your</span> <span class=n>example</span><span class=p>,</span> <span class=n>this</span> <span class=n>query</span> <span class=n>operates</span> <span class=n>on</span> <span class=n>a</span> <span class=n>table</span> <span class=n>named</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl><span class=n>using</span> <span class=n>an</span> <span class=n>index</span> <span class=n>named</span> <span class=s2>&#34;idx_user_biz_id&#34;</span> <span class=n>with</span> <span class=n>an</span> <span class=n>index</span> <span class=n>length</span> <span class=n>of</span> <span class=mi>8</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl><span class=n>the</span> <span class=n>comparison</span> <span class=n>column</span> <span class=n>is</span> <span class=n>constant</span> <span class=p>(</span><span class=k>const</span><span class=p>),</span> <span class=n>the</span> <span class=n>system</span> <span class=n>estimates</span> <span class=n>it</span> <span class=n>needs</span> <span class=n>to</span> <span class=n>scan</span> <span class=mi>2</span> <span class=n>rows</span> <span class=n>of</span> <span class=n>data</span><span class=p>,</span> <span class=n>returning</span> <span class=mi>100</span><span class=o>%</span> <span class=n>of</span> <span class=n>the</span> <span class=n>rows</span><span class=p>,</span> <span class=n>with</span> <span class=n>no</span> <span class=n>additional</span> <span class=n>information</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=why-b-trees>Why B+ Trees</h4><p><strong>Balanced Binary Tree</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png title="4. Balanced Binary Tree.png"></p><ul><li>In a balanced binary tree, we can think about the query process.</li><li>Suppose we want to query all data from 5 to 16. We need to query six nodes, and the order retrieved is not naturally sorted, requiring in-order traversal algorithm implementation. So we can see that balanced trees are natural data structures for finding single nodes, but support for range queries is relatively poor.</li><li>The first optimization point, if you want to understand in detail, requires deep understanding of disk pre-read optimization. I think it&rsquo;s not very necessary to understand, but can be simply understood as too many IO operations<ul><li>In balanced trees, logically close places may be physically distant, leading to longer IO times during disk rotation operations</li></ul></li><li>The second optimization point is that there&rsquo;s too much useless data when reading IO data, because the data read back must be larger than the size of a single node&rsquo;s data.</li><li>Additionally, balanced binary trees require rotation to maintain balance, which is difficult to implement efficiently in memory operations</li></ul><p><strong>B Tree</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png title="5. B Tree.png"></p><ul><li>To address the above optimization points, we can naturally optimize from <code>binary</code> to <code>multi-way</code>, thus optimizing the problem of too much useless data in single nodes. Because when single nodes are larger, the number of IO operations also decreases.</li><li>This naturally leads to the idea of B trees. By expanding nodes to form multi-way structures.</li><li>But actually thinking carefully, in-order traversal algorithm implementation is still needed. For range queries, optimization is only at the single node level. When the range span is large, there&rsquo;s still room for performance optimization.</li></ul><p><strong>B+ Tree</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png title="6. B+ Tree.png"></p><ul><li>B+ trees first further optimize single node storage efficiency (no Values). This way single nodes can support more <code>branches</code>.</li><li>At the same time, the bottom leaf nodes are combined into a linked list through pointers, thus optimizing traversal logic.<ul><li>Note: The bottom layer of B+ trees contains all nodes from upper layers.</li></ul></li></ul><h3 id=b-tree-composite-indexes>B+ Tree Composite Indexes</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png title="7. Composite Index.png"></p><ul><li>We&rsquo;ve understood the B+ tree part, which can be simply understood as clustered indexes with Values at the bottom leaf nodes.</li><li>Now let&rsquo;s understand composite indexes.</li></ul><p><strong>Leftmost Matching Principle</strong></p><ul><li>The specific principle doesn&rsquo;t need explanation, just understanding.</li></ul><p><strong>Why are B+ Tree Indexes Sorted?</strong></p><ul><li>In the above diagram, our first-level index is ordered, which is easy to understand. When the first-level index is fixed, its second-level index underneath is also ordered.</li><li>My understanding is that B+ trees first search the first-level index. When the first-level index is determined, the B+ tree converts to a second-level index B+ tree. And so on.<ul><li>Note: Composite indexes are on one tree.</li></ul></li></ul><p><strong>Why Do B+ Tree Indexes Fail?</strong></p><ul><li>First, we can understand that the second-level index order when first-level index = 1 and the second-level index order when first-level index = 2 have no necessary sequential relationship. They just both have the same monotonicity.</li><li>Following my previous direction of index tree changes, when the first-level index becomes a range, there&rsquo;s more than one tree for second-level indexes. We can&rsquo;t perform the same range single query on multiple trees. We can only combine multiple times.</li></ul><h4 id=what-is-table-lookup>What is Table Lookup?</h4><ul><li>Assuming everyone understands clustered indexes and secondary indexes.</li><li>Table lookup, simply put, means after the secondary index is finished, it can&rsquo;t continue, like in the previous table.</li><li>Note: Type represents the optimization order of access types, from best to worst: system->const->eq_ref->ref->ref_or_null->index_merge->unique_subquery->index_subquery->range->index->all. Generally, we hope to reach ref and eq_ref levels, and range queries need to reach range level.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>      </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;User ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>biz_id</span><span class=w>  </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Business ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Business information&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>updated</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;User&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>Using index completely</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>498380</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>ChatGPT</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>involves</span> <span class=n>the</span> <span class=s2>&#34;user&#34;</span> <span class=n>table</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>table</span> <span class=n>access</span> <span class=n>method</span> <span class=n>is</span> <span class=s2>&#34;ref&#34;</span><span class=p>,</span> <span class=n>indicating</span> <span class=n>that</span> <span class=n>an</span> <span class=n>index</span> <span class=n>was</span> <span class=n>used</span> <span class=k>for</span> <span class=n>the</span> <span class=n>query</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>index</span> <span class=n>used</span> <span class=n>is</span> <span class=s2>&#34;idx_user_biz_id&#34;</span><span class=p>,</span> <span class=ow>and</span> <span class=n>the</span> <span class=n>query</span> <span class=n>uses</span> <span class=n>this</span> <span class=n>index</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>index</span> <span class=n>length</span> <span class=n>used</span> <span class=n>is</span> <span class=mi>8</span> <span class=n>bytes</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>reference</span> <span class=n>value</span> <span class=n>is</span> <span class=s2>&#34;const&#34;</span><span class=p>,</span> <span class=n>indicating</span> <span class=n>the</span> <span class=n>query</span> <span class=n>uses</span> <span class=n>a</span> <span class=n>constant</span> <span class=n>value</span> <span class=k>for</span> <span class=n>filtering</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>returns</span> <span class=mi>498380</span> <span class=n>rows</span> <span class=n>with</span> <span class=n>a</span> <span class=n>filtering</span> <span class=n>rate</span> <span class=n>of</span> <span class=mi>100</span><span class=o>%.</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Using index&#34;</span> <span class=n>indicates</span> <span class=n>the</span> <span class=n>query</span> <span class=n>uses</span> <span class=n>a</span> <span class=n>covering</span> <span class=n>index</span><span class=p>,</span> <span class=n>meaning</span> <span class=n>query</span> <span class=n>results</span> <span class=n>can</span> <span class=n>be</span> <span class=n>obtained</span> <span class=n>directly</span> <span class=n>from</span> <span class=n>the</span> <span class=n>index</span> <span class=n>without</span> <span class=n>accessing</span> <span class=n>table</span> <span class=n>data</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Table lookup once</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>498380</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>ChatGPT</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>This</span> <span class=n>is</span> <span class=n>a</span> <span class=n>simple</span> <span class=n>SELECT</span> <span class=n>query</span> <span class=n>with</span> <span class=n>no</span> <span class=n>subqueries</span> <span class=ow>or</span> <span class=n>joins</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>references</span> <span class=n>a</span> <span class=n>table</span> <span class=n>named</span> <span class=n>user</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>uses</span> <span class=n>an</span> <span class=n>index</span> <span class=n>named</span> <span class=n>idx_user_biz_id</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>index</span> <span class=n>length</span> <span class=n>is</span> <span class=mf>8.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>uses</span> <span class=n>a</span> <span class=n>constant</span> <span class=n>value</span> <span class=k>for</span> <span class=n>reference</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>scanned</span> <span class=mi>498380</span> <span class=n>rows</span> <span class=ow>and</span> <span class=n>filtered</span> <span class=mi>100</span> <span class=n>rows</span> <span class=n>based</span> <span class=n>on</span> <span class=n>the</span> <span class=n>WHERE</span> <span class=n>condition</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>query</span> <span class=n>has</span> <span class=n>no</span> <span class=n>other</span> <span class=n>special</span> <span class=n>conditions</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Table lookup once (more table lookup data)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>498380</td><td style=text-align:left>10</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(ChatGPT)
</span></span><span class=line><span class=cl>The given query is a simple SELECT query involving a table named &#34;user&#34;.
</span></span><span class=line><span class=cl>The query uses an index named &#34;idx_user_biz_id&#34; and uses a WHERE clause.
</span></span><span class=line><span class=cl>The query uses regular secondary index for equality matching.
</span></span><span class=line><span class=cl>The query returned 498380 rows of results.
</span></span></code></pre></td></tr></table></div></div><p><strong>Index Pushdown & Covering Index</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id_msg</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>biz_id</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>(</span><span class=mi>8</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;99dd8a31&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>const,const</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;99dd8a31&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>const,const</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>ChatGPT</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>type</span> <span class=n>field</span> <span class=n>represents</span> <span class=n>the</span> <span class=n>query</span> <span class=n>access</span> <span class=n>method</span><span class=p>,</span> <span class=n>from</span> <span class=n>most</span> <span class=n>optimal</span> <span class=n>to</span> <span class=n>least</span> <span class=n>optimal</span><span class=p>:</span> <span class=n>system</span><span class=p>,</span> <span class=k>const</span><span class=p>,</span> <span class=n>eq_ref</span><span class=p>,</span> <span class=n>ref</span><span class=p>,</span> <span class=n>ref_or_null</span><span class=p>,</span> <span class=n>index_merge</span><span class=p>,</span> <span class=n>unique_subquery</span><span class=p>,</span> <span class=n>index_subquery</span><span class=p>,</span> <span class=nb>range</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>all</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>possible_keys</span> <span class=n>lists</span> <span class=n>indexes</span> <span class=n>that</span> <span class=n>might</span> <span class=n>help</span> <span class=n>the</span> <span class=n>query</span><span class=p>,</span> <span class=k>if</span> <span class=n>empty</span> <span class=n>it</span> <span class=n>means</span> <span class=n>no</span> <span class=n>available</span> <span class=n>indexes</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=n>lists</span> <span class=n>the</span> <span class=n>actually</span> <span class=n>selected</span> <span class=n>index</span><span class=p>,</span> <span class=k>if</span> <span class=n>NULL</span> <span class=n>it</span> <span class=n>means</span> <span class=n>no</span> <span class=n>index</span> <span class=n>was</span> <span class=n>used</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Extra</span> <span class=n>lists</span> <span class=n>additional</span> <span class=n>information</span><span class=p>,</span> <span class=k>for</span> <span class=n>example</span> <span class=n>Using</span> <span class=n>where</span> <span class=n>means</span> <span class=n>WHERE</span> <span class=n>conditions</span> <span class=n>were</span> <span class=n>used</span> <span class=k>for</span> <span class=n>filtering</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where; Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>10</td><td style=text-align:left>Using index condition; Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where; Using index; Using filesort</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>10</td><td style=text-align:left>Using index condition; Using where; Using filesort</td></tr></tbody></table><h2 id=in-or-exists>IN or EXISTS?</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>task</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>      </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;User ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>biz_id</span><span class=w>  </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Business ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Business information&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>updated</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;Order&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_task_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>task</span><span class=p>(</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=k>IN</span><span class=w> </span><span class=n>start_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>end_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>bizId</span><span class=w> </span><span class=nb>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>start_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WHILE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>end_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>DO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>biz_id</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>bizId</span><span class=p>,</span><span class=w> </span><span class=k>SUBSTRING</span><span class=p>(</span><span class=n>MD5</span><span class=p>(</span><span class=n>RAND</span><span class=p>()),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Insert first business id 1 data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Insert one million other data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Insert second business id 1 data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span><span class=w> </span><span class=mi>11</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>13</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=w> </span><span class=mi>15</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=analysis>Analysis</h3><ul><li>Principle of small table driving large table</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>null</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>u</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>test.task.biz_id</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:52] 1 row retrieved starting from 1 in 2 s 784 ms (execution: 2 s 766 ms, fetching: 18 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>u</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>null</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>t</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>test.u.biz_id</td><td style=text-align:left>5</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:57] 1 row retrieved starting from 1 in 4 s 527 ms (execution: 4 s 504 ms, fetching: 23 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.task.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:35] 1 row retrieved starting from 1 in 443 ms (execution: 399 ms, fetching: 44 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.user.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:58] 1 row retrieved starting from 1 in 545 ms (execution: 507 ms, fetching: 38 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.task.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=n>format</span><span class=o>=</span><span class=n>tree</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- -&gt; Aggregate: count(0)  (cost=3189638.65 rows=1)
</span></span></span><span class=line><span class=cl><span class=c1>--     -&gt; Nested loop inner join  (cost=1594821.05 rows=15948176)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Index scan on task using idx_task_biz_id  (cost=1.85 rows=16)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Single-row index lookup on &lt;subquery2&gt; using &lt;auto_distinct_key&gt; (biz_id=task.biz_id)
</span></span></span><span class=line><span class=cl><span class=c1>--             -&gt; Materialize with deduplication  (cost=202826.45..202826.45 rows=996761)
</span></span></span><span class=line><span class=cl><span class=c1>--                 -&gt; Index scan on user using idx_user_biz_id_msg  (cost=103150.35 rows=996761)
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:59] 1 row retrieved starting from 1 in 459 ms (execution: 421 ms, fetching: 38 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.user.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=n>format</span><span class=o>=</span><span class=n>tree</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- -&gt; Aggregate: count(0)  (cost=3392461.65 rows=1)
</span></span></span><span class=line><span class=cl><span class=c1>--     -&gt; Nested loop inner join  (cost=1797644.05 rows=15948176)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Index scan on user using idx_user_biz_id_msg  (cost=103150.35 rows=996761)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Single-row index lookup on &lt;subquery2&gt; using &lt;auto_distinct_key&gt; (biz_id=`user`.biz_id)
</span></span></span><span class=line><span class=cl><span class=c1>--             -&gt; Materialize with deduplication  (cost=3.45..3.45 rows=16)
</span></span></span><span class=line><span class=cl><span class=c1>--                 -&gt; Index scan on task using idx_task_biz_id  (cost=1.85 rows=16)
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(ChatGPT)
</span></span><span class=line><span class=cl>In the first query, the system first performs an index scan on the task table, scanning the idx_task_biz_id index.
</span></span><span class=line><span class=cl>Then it performs a single-row index lookup on subquery&lt;subquery2&gt;, looking up with the key biz_id=task.biz_id.
</span></span><span class=line><span class=cl>This is a typical nested loop join, where the system gets a row of data from the task table, then searches for this row in subquery&lt;subquery2&gt;.
</span></span><span class=line><span class=cl>This process continues until all rows in the task table have been searched in subquery&lt;subquery2&gt;.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>In the second query, the system first performs an index scan on the user table, scanning the idx_user_biz_id_msg index.
</span></span><span class=line><span class=cl>Then it performs a single-row index lookup on subquery&lt;subquery2&gt;, looking up with the key biz_id=user.biz_id.
</span></span><span class=line><span class=cl>This query&#39;s execution process is similar to the first query, but this time starting from the user table.
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:05:00] 1 row retrieved starting from 1 in 567 ms (execution: 523 ms, fetching: 44 ms)
</span></span></span></code></pre></td></tr></table></div></div><ul><li>In the materials I&rsquo;ve researched, it&rsquo;s repeatedly emphasized that small table driving produces less data volume than large table driving. I find this hard to accept. Whether small table or large table driving, the final data volume should be the same, otherwise the results would be different, and mathematically 10 * 10000 and 10000 * 10 should produce the same data volume.</li><li>However, there is indeed a difference in IO. Large table driving will perform IO and index query operations according to the large table.</li></ul><p>Reference</p><ol><li><a href=http://blog.codinglabs.org/articles/theory-of-mysql-index.html target=_blank rel="noopener noreffer">MySQL Index Background Data Structures and Algorithm Principles</a></li><li><a href=https://blog.csdn.net/qq_43352723/article/details/120516281 target=_blank rel="noopener noreffer">(MySQL) Simple and Easy-to-Understand B+ Tree Index Introduction</a></li><li><a href="https://www.xjx100.cn/news/311647.html?action=onClick" target=_blank rel="noopener noreffer">MySQL B+ Tree Index Usage</a></li><li><a href=https://blog.csdn.net/qq_44918090/article/details/120278339 target=_blank rel="noopener noreffer">Differences Between B Trees and B+ Trees</a></li><li><a href=https://blog.csdn.net/zhibo_lv/article/details/117846795 target=_blank rel="noopener noreffer">MySQL Practice - Huge Impact of Limit and Order by on Query Efficiency</a></li><li><a href=https://zhuanlan.zhihu.com/p/380671457 target=_blank rel="noopener noreffer">Understanding Order By in One Read: Detailed Explanation</a></li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-10-02&nbsp;<a class=git-hash href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io/commit/2e18c300b2ee848f2953b2e4671d9a9d358d100f target=_blank title="commit by haotian(haotian@codemao.cn) 2e18c300b2ee848f2953b2e4671d9a9d358d100f: Enhance bilingual support and content structure in documentation">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>2e18c30</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/en/2025/09/3.-mysql-fast-query-insights/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. MySQL Fast Query Insights" data-hashtags=MySQL,index,database,optimization><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/ data-hashtag=MySQL><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. MySQL Fast Query Insights"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. MySQL Fast Query Insights"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://gooddayday.github.io/en/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. MySQL Fast Query Insights"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/en/tags/mysql/>MySQL</a>,&nbsp;<a href=/en/tags/index/>Index</a>,&nbsp;<a href=/en/tags/database/>Database</a>,&nbsp;<a href=/en/tags/optimization/>Optimization</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/en/>Home</a></span></section></div><div class=post-nav><a href=/en/2025/09/2.-file-transfer-optimization/ class=prev rel=prev title="[Network] 1. File Transfer Optimization Sharing"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>[Network] 1. File Transfer Optimization Sharing</a>
<a href=/en/2025/09/4.-lombok/ class=next rel=next title="[Java] 1. Lombok">[Java] 1. Lombok<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><span class=author itemprop=copyrightHolder>&nbsp;<a href=/en/ target=_blank>GoodyHao</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/css/auto-numbering.css><link rel=stylesheet href=/css/svg-fullwidth.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"DIC_kwDOPtWtCc4CvteQ",darkTheme:"dark",emitMetadata:"0",inputPosition:"bottom",lang:"en",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"GOODDAYDAY/GOODDAYDAY.github.io",repoId:"R_kgDOPtWtCQ"}},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>