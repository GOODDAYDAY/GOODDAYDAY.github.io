+++
date = '2025-09-24T23:46:17+08:00'
draft = false
title = '[Github] 2. MyBatis Generator è‡ªå®šä¹‰æ’ä»¶'
categories = ["Github", "Chinese", "MyBatis", "plugins"]
tags = ["Github", "Chinese", "MyBatis", "plugins"]
+++

# [Github] 2. MyBatis Generator è‡ªå®šä¹‰æ’ä»¶

> **ğŸ”— é¡¹ç›®åœ°å€**: [mybatis-generator-custome-plugins](https://github.com/GOODDAYDAY/mybatis-generator-custome-plugins)

ä¸º MyBatis Generator è®¾è®¡çš„å¼ºå¤§è‡ªå®šä¹‰æ’ä»¶é›†åˆï¼Œä¸“é—¨é’ˆå¯¹ MySQL æ•°æ®åº“ç‰¹æ€§ï¼Œæä¾› DTO å±‚ç”Ÿæˆã€Service å±‚è‡ªåŠ¨ç”Ÿæˆç­‰åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½æ¦‚è§ˆ

æœ¬æ’ä»¶é›†åˆåŒ…å«ä»¥ä¸‹6ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼š

| æ’ä»¶åç§°                         | åŠŸèƒ½æè¿°                            | æ ¸å¿ƒç‰¹æ€§                |
|------------------------------|---------------------------------|---------------------|
| `InsertIgnoreIntoPlugin`     | MySQL INSERT IGNOREè¯­å¥æ”¯æŒ         | æ‰¹é‡æ’å…¥å¿½ç•¥é‡å¤è®°å½•          |
| `InsertOnDuplicateKeyPlugin` | MySQL ON DUPLICATE KEY UPDATEæ”¯æŒ | æ’å…¥å†²çªæ—¶è‡ªåŠ¨æ›´æ–°           |
| `ReplaceIntoPlugin`          | MySQL REPLACE INTOè¯­å¥æ”¯æŒ          | æ›¿æ¢æ’å…¥æ“ä½œ              |
| `DtoGeneratorPlugin`         | DTOå±‚ä»£ç ç”Ÿæˆ                        | Lombokæ³¨è§£ï¼ŒEntityè½¬æ¢æ–¹æ³• |
| `ServiceGeneratorPlugin`     | Serviceå±‚ä»£ç ç”Ÿæˆ                    | æ¥å£+å®ç°ï¼Œå®Œæ•´CRUDæ“ä½œ      |
| `CustomerMapperPlugin`       | è‡ªå®šä¹‰Mapperç”Ÿæˆ                     | æ‰©å±•åŸç”ŸMapperåŠŸèƒ½        |

## ğŸ“¦ ä¾èµ–åˆ†æ

### æ ¸å¿ƒä¾èµ–

```xml
<!-- MyBatis Generatoræ ¸å¿ƒä¾èµ– -->
<dependency>
    <groupId>org.mybatis.generator</groupId>
    <artifactId>mybatis-generator-core</artifactId>
    <version>1.4.2</version>
</dependency>

<!-- MyBatis Dynamic SQLæ”¯æŒ -->
<dependency>
    <groupId>org.mybatis.dynamic-sql</groupId>
    <artifactId>mybatis-dynamic-sql</artifactId>
    <version>1.5.2</version>
</dependency>

<!-- MyBatis Spring Booté›†æˆ -->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>3.0.5</version>
</dependency>
```

### Mavenæ’ä»¶é…ç½®

```xml
<plugin>
    <groupId>org.mybatis.generator</groupId>
    <artifactId>mybatis-generator-maven-plugin</artifactId>
    <version>1.4.2</version>
    <configuration>
        <verbose>true</verbose>
        <overwrite>true</overwrite>
    </configuration>
    <dependencies>
        <dependency>
            <groupId>com.goody.utils</groupId>
            <artifactId>mybatis-generator-custome-plugins</artifactId>
            <version>1.0.0</version>
        </dependency>
    </dependencies>
</plugin>
```

## ğŸ”§ æ’ä»¶è¯¦è¿°

### 1. MySQLæ‰©å±•æ’ä»¶

#### InsertIgnoreIntoPlugin

- **åŠŸèƒ½**: ä¸ºMapperæ·»åŠ `INSERT IGNORE`è¯­å¥æ”¯æŒ
- **ç”Ÿæˆæ–¹æ³•**: `insertIgnoreCustom()`, `insertIgnoreBatchCustom()`
- **åº”ç”¨åœºæ™¯**: æ‰¹é‡æ’å…¥æ—¶å¿½ç•¥ä¸»é”®å†²çªè®°å½•

#### InsertOnDuplicateKeyPlugin

- **åŠŸèƒ½**: ä¸ºMapperæ·»åŠ `ON DUPLICATE KEY UPDATE`è¯­å¥æ”¯æŒ
- **ç”Ÿæˆæ–¹æ³•**: `insertOnDuplicateKeyCustom()`, `insertOnDuplicateKeyBatchCustom()`
- **åº”ç”¨åœºæ™¯**: æ’å…¥æ—¶é‡åˆ°é‡å¤é”®åˆ™æ›´æ–°è®°å½•

#### ReplaceIntoPlugin

- **åŠŸèƒ½**: ä¸ºMapperæ·»åŠ `REPLACE INTO`è¯­å¥æ”¯æŒ
- **ç”Ÿæˆæ–¹æ³•**: `replaceIntoCustom()`, `replaceIntoBatchCustom()`
- **åº”ç”¨åœºæ™¯**: å­˜åœ¨åˆ™æ›¿æ¢ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥

### 2. DTOå±‚ç”Ÿæˆæ’ä»¶

#### DtoGeneratorPlugin

- **åŠŸèƒ½**: è‡ªåŠ¨ç”ŸæˆDTOç±»
- **ç‰¹æ€§**:
    - Lombokæ³¨è§£æ”¯æŒ(`@Data`, `@Builder`, `@AllArgsConstructor`, `@NoArgsConstructor`)
    - è‡ªåŠ¨ç”Ÿæˆ`fromEntity()`å’Œ`toEntity()`è½¬æ¢æ–¹æ³•
    - åŒ…ç»“æ„: `*.model.dto`

### 3. Serviceå±‚ç”Ÿæˆæ’ä»¶

#### ServiceGeneratorPlugin

- **åŠŸèƒ½**: è‡ªåŠ¨ç”ŸæˆServiceæ¥å£å’Œå®ç°ç±»
- **ç‰¹æ€§**:
    - å®Œæ•´CRUDæ“ä½œæ–¹æ³•
    - æ”¯æŒå•ä¸»é”®å’Œè”åˆä¸»é”®
    - Springæ³¨è§£æ”¯æŒ(`@Service`, `@Autowired`)
    - åŒ…ç»“æ„: `*.service.interfaces` å’Œ `*.service.impl`

### 4. è‡ªå®šä¹‰Mapperæ’ä»¶

#### CustomerMapperPlugin

- **åŠŸèƒ½**: ç”Ÿæˆæ‰©å±•Mapperæ¥å£
- **åŒ…ç»“æ„**: `*.dao.customer`

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### æ­¥éª¤1: æ·»åŠ ä¾èµ–

å°†æ’ä»¶æ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼š

```xml
<dependency>
    <groupId>com.goody.utils</groupId>
    <artifactId>mybatis-generator-custome-plugins</artifactId>
    <version>1.0.0</version>
</dependency>
```

### æ­¥éª¤2: é…ç½®generatorConfig.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE generatorConfiguration
    PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
    "https://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">

<generatorConfiguration>
    <classPathEntry location="${user.home}/.m2/repository/mysql/mysql-connector-java/8.0.28/mysql-connector-java-8.0.28.jar"/>

    <context id="dao" targetRuntime="MyBatis3DynamicSql">
        <property name="autoDelimitKeywords" value="true"/>
        <property name="beginningDelimiter" value="`"/>
        <property name="endingDelimiter" value="`"/>

        <!-- æ ‡å‡†æ’ä»¶ -->
        <plugin type="org.mybatis.generator.plugins.SerializablePlugin" />
        <plugin type="org.mybatis.generator.plugins.EqualsHashCodePlugin" />
        <plugin type="org.mybatis.generator.plugins.ToStringPlugin" />
        <plugin type="org.mybatis.generator.plugins.FluentBuilderMethodsPlugin" />

        <!-- è‡ªå®šä¹‰æ’ä»¶ -->
        <plugin type="com.goody.utils.mybatis.plugin.InsertIgnoreIntoPlugin" />
        <plugin type="com.goody.utils.mybatis.plugin.InsertOnDuplicateKeyPlugin" />
        <plugin type="com.goody.utils.mybatis.plugin.ReplaceIntoPlugin" />
        <plugin type="com.goody.utils.mybatis.plugin.DtoGeneratorPlugin"/>
        <plugin type="com.goody.utils.mybatis.plugin.ServiceGeneratorPlugin"/>
        <plugin type="com.goody.utils.mybatis.plugin.CustomerMapperPlugin"/>

        <commentGenerator>
            <property name="addRemarkComments" value="true" />
            <property name="suppressDate" value="true"/>
        </commentGenerator>

        <jdbcConnection driverClass="com.mysql.cj.jdbc.Driver"
                        connectionURL="jdbc:mysql://127.0.0.1:3306/your_database"
                        userId="your_username"
                        password="your_password">
            <property name="useSSL" value="false" />
            <property name="serverTimezone" value="Asia/Shanghai" />
            <property name="nullCatalogMeansCurrent" value="true" />
        </jdbcConnection>

        <javaTypeResolver >
            <property name="forceBigDecimals" value="true" />
            <property name="useJSR310Types" value="true" />
        </javaTypeResolver>

        <javaModelGenerator targetPackage="com.yourpackage.model.entity"
                           targetProject="src/main/java">
            <property name="enableSubPackages" value="true" />
            <property name="trimStrings" value="true" />
        </javaModelGenerator>

        <javaClientGenerator type="ANNOTATEDMAPPER"
                           targetPackage="com.yourpackage.model.dao"
                           targetProject="src/main/java">
            <property name="enableSubPackages" value="true" />
        </javaClientGenerator>

        <!-- é…ç½®è¦ç”Ÿæˆçš„è¡¨ -->
        <table schema="your_schema" tableName="your_table">
            <property name="useActualColumnNames" value="false"/>
        </table>

    </context>
</generatorConfiguration>
```

### æ­¥éª¤3: æ‰§è¡Œä»£ç ç”Ÿæˆ

```bash
mvn mybatis-generator:generate
```

![presentation.gif](/images/8.%20MyBatis%20Generator%20Custom%20Plugins/presentation.gif)

## ğŸ“ é…ç½®ç¤ºä¾‹

### å•ä¸»é”®è¡¨é…ç½®

```xml
<table schema="toy" tableName="example_single_pk">
    <property name="useActualColumnNames" value="false"/>
</table>
```

### è”åˆä¸»é”®è¡¨é…ç½®

```xml
<table schema="toy" tableName="example_double_pk">
    <property name="useActualColumnNames" value="false"/>
</table>
```

## ğŸ—ï¸ ç”Ÿæˆä»£ç åˆ†æ

æ’ä»¶ä¼šä¸ºæ¯ä¸ªè¡¨ç”Ÿæˆå®Œæ•´çš„ä»£ç ç»“æ„ï¼š

### æ–‡ä»¶ç»“æ„

```
src/main/java/
â”œâ”€â”€ com/yourpackage/model/
â”‚   â”œâ”€â”€ entity/              # Entityå®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ Example.java
â”‚   â”‚   â””â”€â”€ ExampleDoublePk.java
â”‚   â”œâ”€â”€ dao/                 # æ ‡å‡†Mapperæ¥å£
â”‚   â”‚   â”œâ”€â”€ ExampleMapper.java
â”‚   â”‚   â”œâ”€â”€ ExampleDynamicSqlSupport.java
â”‚   â”‚   â””â”€â”€ customer/        # è‡ªå®šä¹‰Mapperæ¥å£
â”‚   â”‚       â””â”€â”€ CustomerExampleMapper.java
â”‚   â””â”€â”€ dto/                 # DTOç±»
â”‚       â”œâ”€â”€ ExampleDTO.java
â”‚       â””â”€â”€ ExampleDoublePkDTO.java
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ interfaces/          # Serviceæ¥å£
â”‚   â”‚   â”œâ”€â”€ IExampleService.java
â”‚   â”‚   â””â”€â”€ IExampleDoublePkService.java
â”‚   â””â”€â”€ impl/               # Serviceå®ç°
â”‚       â”œâ”€â”€ ExampleServiceImpl.java
â”‚       â””â”€â”€ ExampleDoublePkServiceImpl.java
```

### æ ¸å¿ƒä»£ç ç‰‡æ®µåˆ†æ

#### 1. MySQLæ‰©å±•æ–¹æ³• (Mapperå±‚)

```java
@Mapper
public interface ExampleMapper {
    // æ ‡å‡†ç”Ÿæˆçš„æ–¹æ³•...

    // INSERT IGNOREæ”¯æŒ
    @Insert({"<script>" +
            " INSERT IGNORE INTO example" +
            " (`id`, `name`, `created`, `updated`)" +
            " VALUES" +
            " (#{item.id}, #{item.name}, #{item.created}, #{item.updated})" +
        "</script>"})
    void insertIgnoreCustom(@Param("item") Example record);

    // æ‰¹é‡INSERT IGNORE
    @Insert({"<script>" +
            " INSERT IGNORE INTO example" +
            " (`id`, `name`, `created`, `updated`)" +
            " VALUES" +
            " <foreach collection='items' item='item' separator=','>" +
            "   (#{item.id}, #{item.name}, #{item.created}, #{item.updated})" +
            " </foreach>" +
        "</script>"})
    void insertIgnoreBatchCustom(@Param("items") Collection<Example> records);

    // ON DUPLICATE KEY UPDATEæ”¯æŒ
    @Insert({"<script>" +
            " INSERT INTO example" +
            " (`id`, `name`, `created`, `updated`)" +
            " VALUES" +
            " (#{item.id}, #{item.name}, #{item.created}, #{item.updated})" +
            " AS r" +
            " ON DUPLICATE KEY UPDATE" +
            "   name = r.name, updated = r.updated" +
        "</script>"})
    void insertOnDuplicateKeyCustom(@Param("item") Example record);
}
```

#### 2. DTOç±» (æ•°æ®ä¼ è¾“å±‚)

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class ExampleDTO {
    private Long id;
    private String name;
    private LocalDateTime created;
    private LocalDateTime updated;

    // Entityè½¬DTO
    public static ExampleDTO fromEntity(Example entity) {
        if (entity == null) return null;

        return ExampleDTO.builder()
            .id(entity.getId())
            .name(entity.getName())
            .created(entity.getCreated())
            .updated(entity.getUpdated())
            .build();
    }

    // DTOè½¬Entity
    public Example toEntity() {
        return new Example()
            .withId(this.id)
            .withName(this.name)
            .withCreated(this.created)
            .withUpdated(this.updated);
    }
}
```

#### 3. Serviceæ¥å£ (æœåŠ¡å±‚æ¥å£)

**å•ä¸»é”®Serviceæ¥å£**:

```java
public interface IExampleService {
    int save(ExampleDTO dto);
    int saveBatch(List<ExampleDTO> dtoList);
    int update(ExampleDTO dto);
    int deleteById(Long id);                    // å•å‚æ•°
    ExampleDTO findById(Long id);               // å•å‚æ•°
    List<ExampleDTO> findAll();
}
```

**è”åˆä¸»é”®Serviceæ¥å£** (æ’ä»¶å·²ä¿®å¤):

```java
public interface IExampleDoublePkService {
    int save(ExampleDoublePkDTO dto);
    int saveBatch(List<ExampleDoublePkDTO> dtoList);
    int update(ExampleDoublePkDTO dto);
    int deleteById(Long id, Long id2);          // å¤šå‚æ•°æ”¯æŒ
    ExampleDoublePkDTO findById(Long id, Long id2);  // å¤šå‚æ•°æ”¯æŒ
    List<ExampleDoublePkDTO> findAll();
}
```

#### 4. Serviceå®ç° (æœåŠ¡å±‚å®ç°)

**è”åˆä¸»é”®å¤„ç†çš„æ ¸å¿ƒæ”¹è¿›**:

```java
@Service
public class ExampleDoublePkServiceImpl implements IExampleDoublePkService {

    @Autowired
    private ExampleDoublePkMapper exampleDoublePkMapper;

    @Override
    public int deleteById(Long id, Long id2) {
        if (id == null || id2 == null) {
            return 0;
        }
        // æ­£ç¡®è°ƒç”¨è”åˆä¸»é”®æ–¹æ³•
        return exampleDoublePkMapper.deleteByPrimaryKey(id, id2);
    }

    @Override
    public ExampleDoublePkDTO findById(Long id, Long id2) {
        if (id == null || id2 == null) {
            return null;
        }
        // æ­£ç¡®è°ƒç”¨è”åˆä¸»é”®æ–¹æ³•
        ExampleDoublePk entity = exampleDoublePkMapper
            .selectByPrimaryKey(id, id2).orElse(null);
        return entity != null ? ExampleDoublePkDTO.fromEntity(entity) : null;
    }
}
```

### å…³é”®ç‰¹æ€§åˆ†æ

#### è”åˆä¸»é”®æ”¯æŒ

- **é—®é¢˜**: ä¹‹å‰ç‰ˆæœ¬é”™è¯¯åœ°å°è¯•ä½¿ç”¨å•ä¸€ä¸»é”®ç±»å‹
- **è§£å†³**: è‡ªåŠ¨æ£€æµ‹ä¸»é”®åˆ—æ•°é‡ï¼Œä¸ºè”åˆä¸»é”®ç”Ÿæˆå¤šå‚æ•°æ–¹æ³•
- **å®ç°**: `List<IntrospectedColumn> primaryKeyColumns`

#### MySQLç‰¹æœ‰åŠŸèƒ½

- **INSERT IGNORE**: å¿½ç•¥é‡å¤é”®é”™è¯¯ï¼Œç»§ç»­æ’å…¥å…¶ä»–è®°å½•
- **ON DUPLICATE KEY UPDATE**: æ’å…¥å†²çªæ—¶è‡ªåŠ¨æ›´æ–°æŒ‡å®šå­—æ®µ
- **REPLACE INTO**: MySQLçš„æ›¿æ¢æ’å…¥æ“ä½œ

#### è‡ªåŠ¨åŒ–ç¨‹åº¦

- **ä¾èµ–æ³¨å…¥**: è‡ªåŠ¨ç”ŸæˆSpring `@Autowired`æ³¨è§£
- **ç©ºå€¼æ£€æŸ¥**: è‡ªåŠ¨ç”Ÿæˆå‚æ•°ç©ºå€¼éªŒè¯
- **è½¬æ¢æ–¹æ³•**: DTOä¸Entityä¹‹é—´çš„è‡ªåŠ¨è½¬æ¢

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
mybatis-generator-custome-plugins/
â”œâ”€â”€ src/main/java/com/goody/utils/mybatis/plugin/
â”‚   â”œâ”€â”€ CustomerMapperPlugin.java
â”‚   â”œâ”€â”€ DtoGeneratorPlugin.java
â”‚   â”œâ”€â”€ InsertIgnoreIntoPlugin.java
â”‚   â”œâ”€â”€ InsertOnDuplicateKeyPlugin.java
â”‚   â”œâ”€â”€ ReplaceIntoPlugin.java
â”‚   â””â”€â”€ ServiceGeneratorPlugin.java
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ generatorConfig.xml
â”œâ”€â”€ src/test/                        # ç”Ÿæˆä»£ç ç¤ºä¾‹
â””â”€â”€ pom.xml
```

## ğŸ¯ ä½¿ç”¨å»ºè®®

1. **å¼€å‘æµç¨‹**: å…ˆè®¾è®¡æ•°æ®åº“è¡¨ç»“æ„ï¼Œç„¶åä½¿ç”¨æ’ä»¶ç”Ÿæˆå®Œæ•´çš„åˆ†å±‚ä»£ç 
2. **è”åˆä¸»é”®**: æ’ä»¶å·²å®Œç¾æ”¯æŒè”åˆä¸»é”®ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ç”Ÿæˆä»£ç 
3. **æ‰©å±•æ€§**: å¯ä»¥ç»§æ‰¿ç”Ÿæˆçš„Serviceæ¥å£ï¼Œæ·»åŠ å¤æ‚ä¸šåŠ¡é€»è¾‘
4. **MySQLä¼˜åŒ–**: åˆç†ä½¿ç”¨INSERT IGNOREå’ŒON DUPLICATE KEYåŠŸèƒ½æå‡æ€§èƒ½

## ğŸ” æºç æ·±åº¦åˆ†æ

*æ­¤éƒ¨åˆ†ä¸ºå¼€å‘è€…æä¾›æ’ä»¶å®ç°ç»†èŠ‚çš„æ·±å…¥æ´å¯Ÿï¼Œé€‚åˆå¸Œæœ›ç†è§£æˆ–æ‰©å±•æ’ä»¶åŠŸèƒ½çš„å¼€å‘è€…é˜…è¯»ã€‚*

### æ’ä»¶æ¶æ„æ¦‚è§ˆ

æ‰€æœ‰æ’ä»¶éƒ½ç»§æ‰¿ `PluginAdapter` å¹¶éµå¾ªMyBatis Generatorçš„æ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼š

```java
public abstract class PluginAdapter implements Plugin {
    // éªŒè¯é˜¶æ®µ
    public boolean validate(List<String> warnings);

    // ä»£ç ç”Ÿæˆé’©å­
    public boolean clientGenerated(Interface interfaze, IntrospectedTable introspectedTable);
    public List<GeneratedJavaFile> contextGenerateAdditionalJavaFiles(IntrospectedTable introspectedTable);
}
```

### InsertIgnoreIntoPlugin å®ç°åˆ†æ

#### æ ¸å¿ƒæ–¹æ³•ç”Ÿæˆç­–ç•¥

æ’ä»¶ä½¿ç”¨ç²¾å·§çš„æ–¹æ³•åŠ¨æ€ç”ŸæˆSQLæ¨¡æ¿ï¼š

```java
private Method insertIgnoreIntoOne(Interface interfaze, IntrospectedTable introspectedTable) {
    // ä½¿ç”¨Stream APIè¿›è¡ŒåŠ¨æ€åˆ—æ˜ å°„
    final String columnNames = introspectedTable.getAllColumns()
            .stream()
            .map(column -> String.format("`%s`", column.getActualColumnName()))
            .collect(Collectors.joining(", "));

    // MyBatisè¯­æ³•çš„å‚æ•°ç»‘å®š
    final String columnValueNames = introspectedTable.getAllColumns()
            .stream()
            .map(column -> String.format("#{item.%s}", column.getJavaProperty()))
            .collect(Collectors.joining(", "));

    // åŸºäºæ¨¡æ¿çš„æ³¨è§£ç”Ÿæˆ
    String insertIgnore = String.format("@Insert({" +
            "\"<script>\" +\n" +
            "            \" INSERT IGNORE INTO %s\" +\n" +
            "              \" (%s)\" +\n" +
            "            \" VALUES\" +\n" +
            "              \"(%s)\" +\n" +
            "        \"</script>\"" +
            "})", tableName, columnNames, columnValueNames);
}
```

#### å…³é”®æŠ€æœ¯åˆ›æ–°

1. **åŸºäºStreamçš„å­—æ®µè½¬æ¢**: é«˜æ•ˆåœ°å°†æ•°æ®åº“æ¨¡å¼è½¬æ¢ä¸ºJavaæ–¹æ³•å‚æ•°
2. **åŠ¨æ€SQLæ¨¡æ¿ç”Ÿæˆ**: åˆ›å»ºå¸¦é€‚å½“è½¬ä¹‰çš„å‚æ•°åŒ–SQL
3. **æ‰¹é‡å¤„ç†æ”¯æŒ**: ä¸ºæ‰¹é‡æ“ä½œè‡ªåŠ¨ç”Ÿæˆ `<foreach>` å¾ªç¯

### DtoGeneratorPlugin å®ç°åˆ†æ

#### åŒ…åè§£æç®—æ³•

```java
private TopLevelClass generateDtoClass(IntrospectedTable introspectedTable) {
    // æ™ºèƒ½åŒ…åè½¬æ¢
    String entityFullType = introspectedTable.getBaseRecordType();
    String entityPackage = entityFullType.substring(0, entityFullType.lastIndexOf('.'));
    String dtoFullPackage = entityPackage.replace(".entity", "." + DTO_PACKAGE);

    // ç±»å‹å®‰å…¨çš„ç±»å®ä¾‹åŒ–
    FullyQualifiedJavaType dtoType = new FullyQualifiedJavaType(dtoFullPackage + "." + dtoClassName);
    TopLevelClass dtoClass = new TopLevelClass(dtoType);
}
```

#### å¸¦å…ƒæ•°æ®ä¿ç•™çš„å­—æ®µç”Ÿæˆ

```java
// å¸¦æ³¨é‡Šä¿ç•™çš„åˆ—åˆ°å­—æ®µè½¬æ¢
for (IntrospectedColumn column : allColumns) {
    Field field = new Field(column.getJavaProperty(), column.getFullyQualifiedJavaType());
    field.setVisibility(JavaVisibility.PRIVATE);

    // ä¿ç•™æ•°æ®åº“åˆ—æ³¨é‡Š
    if (column.getRemarks() != null && !column.getRemarks().trim().isEmpty()) {
        field.addJavaDocLine("/**");
        field.addJavaDocLine(" * " + column.getRemarks());
        field.addJavaDocLine(" */");
    }

    dtoClass.addField(field);
}
```

### ServiceGeneratorPlugin å®ç°åˆ†æ

#### è”åˆä¸»é”®è§£æ

æœ€ç²¾å¦™çš„åŠŸèƒ½æ˜¯æ™ºèƒ½è”åˆä¸»é”®å¤„ç†ï¼š

```java
// åŠ¨æ€ä¸»é”®åˆ†æ
List<IntrospectedColumn> primaryKeyColumns = introspectedTable.getPrimaryKeyColumns();

// è‡ªé€‚åº”æ–¹æ³•ç­¾åç”Ÿæˆ
for (IntrospectedColumn column : primaryKeyColumns) {
    String paramName = column.getJavaProperty();
    method.addParameter(new Parameter(column.getFullyQualifiedJavaType(), paramName));
}

// åŠ¨æ€æ–¹æ³•è°ƒç”¨æ„å»º
StringBuilder methodCall = new StringBuilder("return " + mapperFieldName + ".deleteByPrimaryKey(");
for (int i = 0; i < primaryKeyColumns.size(); i++) {
    if (i > 0) methodCall.append(", ");
    methodCall.append(primaryKeyColumns.get(i).getJavaProperty());
}
methodCall.append(");");
```

#### Serviceå®ç°æ¨¡å¼

```java
// ç©ºå€¼å®‰å…¨çš„å‚æ•°éªŒè¯
for (IntrospectedColumn column : primaryKeyColumns) {
    method.addBodyLine("if (" + column.getJavaProperty() + " == null) {");
    method.addBodyLine("    return 0;");
    method.addBodyLine("}");
}
```

### é«˜çº§æ¨¡å¼å’ŒæŠ€æœ¯

#### ç±»å‹å®‰å…¨å¼ºåŒ–

```java
// æ³›å‹ç±»å‹ä¿ç•™
FullyQualifiedJavaType listType = new FullyQualifiedJavaType("List<" + dtoClassName + ">");
Parameter batchParameter = new Parameter(listType, "dtoList");

// å¯¼å…¥è§£æ
serviceInterface.addImportedType(new FullyQualifiedJavaType("java.util.List"));
```

#### SQLæ³¨å…¥é˜²æŠ¤

æ‰€æœ‰ç”Ÿæˆçš„SQLéƒ½ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼š

```java
// å®‰å…¨ï¼šå‚æ•°åŒ–æŸ¥è¯¢
"INSERT IGNORE INTO " + tableName + " VALUES (#{item.id}, #{item.name})"

// ä¸å®‰å…¨ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆä»ä¸ä½¿ç”¨ï¼‰
"INSERT IGNORE INTO " + tableName + " VALUES (" + item.getId() + ", '" + item.getName() + "')"
```

#### å†…å­˜é«˜æ•ˆç”Ÿæˆ

```java
// å¤§å‹ä»£ç åº“çš„å»¶è¿Ÿæ±‚å€¼æ¨¡å¼
public List<GeneratedJavaFile> contextGenerateAdditionalJavaFiles(IntrospectedTable introspectedTable) {
    List<GeneratedJavaFile> files = new ArrayList<>();

    // ä»…åœ¨éœ€è¦æ—¶ç”Ÿæˆ
    if (shouldGenerateService(introspectedTable)) {
        files.add(createServiceInterface(introspectedTable));
        files.add(createServiceImplementation(introspectedTable));
    }

    return files;
}
```

### è‡ªå®šä¹‰å¼€å‘æ‰©å±•ç‚¹

#### è‡ªå®šä¹‰æ’ä»¶æ¨¡æ¿

```java
public class CustomPlugin extends PluginAdapter {
    @Override
    public boolean validate(List<String> warnings) {
        // æ’ä»¶éªŒè¯é€»è¾‘
        return true;
    }

    @Override
    public boolean clientGenerated(Interface interfaze, IntrospectedTable introspectedTable) {
        // å‘ç°æœ‰Mapperæ¥å£æ·»åŠ æ–¹æ³•
        interfaze.addMethod(createCustomMethod(introspectedTable));
        return super.clientGenerated(interfaze, introspectedTable);
    }

    private Method createCustomMethod(IntrospectedTable table) {
        // è‡ªå®šä¹‰æ–¹æ³•ç”Ÿæˆé€»è¾‘
        Method method = new Method("customMethod");
        method.setVisibility(JavaVisibility.PUBLIC);
        method.setAbstract(true);
        return method;
    }
}
```

#### é…ç½®é©±åŠ¨è¡Œä¸º

```java
@Override
public boolean validate(List<String> warnings) {
    // è¯»å–æ’ä»¶å±æ€§
    String enableFeature = getProperties().getProperty("enableCustomFeature");
    if ("false".equals(enableFeature)) {
        // è·³è¿‡æ’ä»¶æ‰§è¡Œ
        return false;
    }
    return true;
}
```

è¿™ç§æ·±å…¥çš„æºç åˆ†ææ­ç¤ºäº†æ¯ä¸ªæ’ä»¶èƒŒåçš„ç²¾å¦™å·¥ç¨‹ï¼Œå±•ç¤ºäº†å…ˆè¿›çš„Javaä»£ç ç”ŸæˆæŠ€æœ¯å’ŒMyBatis Generatorçš„å¯æ‰©å±•æ€§æ¡†æ¶ã€‚

---

*æœ¬æŠ€æœ¯æ·±åº¦è§£ææ—¨åœ¨ä¸ºMyBatis Generatorè‡ªå®šä¹‰æ’ä»¶çš„æ¶æ„å’Œå®ç°æä¾›å…¨é¢çš„æ´å¯Ÿã€‚*
