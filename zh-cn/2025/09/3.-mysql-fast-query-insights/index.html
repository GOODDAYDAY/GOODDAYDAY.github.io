<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[MySQL] 1. 浅谈 MySQL 快速查询 - GoodyHao's Blog</title><meta name=Description content="Elegance Never Fades"><meta property="og:url" content="https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/"><meta property="og:site_name" content="GoodyHao's Blog"><meta property="og:title" content="[MySQL] 1. 浅谈 MySQL 快速查询"><meta property="og:description" content="[MySQL] 1. 浅谈 MySQL 快速查询 讲在开头 在最开始先举几个我们常用的在平时学习、业务上最常见的优化措施
单位时间内更多的事情
快排使用二分的思想，单次循环内对多个数组进行排序"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-21T23:11:17+08:00"><meta property="article:modified_time" content="2025-10-02T13:51:49+08:00"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="Index"><meta property="article:tag" content="Database"><meta property="article:tag" content="Optimization"><meta property="og:image" content="https://gooddayday.github.io/logo.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gooddayday.github.io/logo.jpg"><meta name=twitter:title content="[MySQL] 1. 浅谈 MySQL 快速查询"><meta name=twitter:description content="[MySQL] 1. 浅谈 MySQL 快速查询 讲在开头 在最开始先举几个我们常用的在平时学习、业务上最常见的优化措施
单位时间内更多的事情
快排使用二分的思想，单次循环内对多个数组进行排序"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/><link rel=prev href=https://gooddayday.github.io/zh-cn/2025/09/2.-file-transfer-optimization/><link rel=next href=https://gooddayday.github.io/zh-cn/2025/09/4.-lombok/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[MySQL] 1. 浅谈 MySQL 快速查询","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/gooddayday.github.io\/zh-cn\/2025\/09\/3.-mysql-fast-query-insights\/"},"image":["https:\/\/gooddayday.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"MySQL, index, database, optimization","wordcount":5315,"url":"https:\/\/gooddayday.github.io\/zh-cn\/2025\/09\/3.-mysql-fast-query-insights\/","datePublished":"2025-09-21T23:11:17+08:00","dateModified":"2025-10-02T13:51:49+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/gooddayday.github.io\/images\/logo.jpg"},"author":{"@type":"Person","name":"GoodyHao"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/zh-cn/ title="GoodyHao's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Elegance Never Fades</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/zh-cn/posts/>所有文章 </a><a class=menu-item href=/zh-cn/tags/>标签 </a><a class=menu-item href=/zh-cn/categories/>分类 </a><a class=menu-item href=/zh-cn/categories/documentation/>文档 </a><a class=menu-item href=/zh-cn/about/>关于 </a><a class=menu-item href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a class=menu-item href=/en/2025/09/3.-mysql-fast-query-insights/ title=English>English</a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/zh-cn/ title="GoodyHao's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Elegance Never Fades</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/zh-cn/posts/ title>所有文章</a><a class=menu-item href=/zh-cn/tags/ title>标签</a><a class=menu-item href=/zh-cn/categories/ title>分类</a><a class=menu-item href=/zh-cn/categories/documentation/ title>文档</a><a class=menu-item href=/zh-cn/about/ title>关于</a><a class=menu-item href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a class=menu-item href=/en/2025/09/3.-mysql-fast-query-insights/ title=English>English</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[MySQL] 1. 浅谈 MySQL 快速查询</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/zh-cn/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>GoodyHao</a></span>&nbsp;<span class=post-category>收录于 <a href=/zh-cn/categories/mysql/><i class="far fa-folder fa-fw" aria-hidden=true></i>MySQL</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-09-21>2025-09-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 5315 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 11 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#讲在开头>讲在开头</a></li><li><a href=#没有索引是否一定会慢>没有索引是否一定会慢？</a></li><li><a href=#索引>索引</a><ul><li><a href=#b树索引>B+树索引</a><ul><li><a href=#为什么是-b树>为什么是 B+树</a></li></ul></li><li><a href=#b树联合索引>B+树联合索引</a><ul><li><a href=#什么是回表>什么是回表？</a></li></ul></li></ul></li><li><a href=#in-还是-exists>IN 还是 EXISTS？</a><ul><li><a href=#分析>分析</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=mysql-1-浅谈-mysql-快速查询>[MySQL] 1. 浅谈 MySQL 快速查询</h1><h2 id=讲在开头>讲在开头</h2><ul><li><p>在最开始先举几个我们常用的在平时学习、业务上最常见的优化措施</p><ol><li><p>单位时间内更多的事情</p><ul><li><p>快排使用二分的思想，单次循环内对多个数组进行排序</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/1.%20%E5%BF%AB%E6%8E%92.jpg title="1. 快排.jpg"></p></li></ul></li><li><p>总量查更少的信息</p><ul><li><p>KMP 算法对主串进行预处理，做到减少匹配次数。这就是逻辑的力量</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/2.%20KMP.jpg title="2. KMP.jpg"></p></li><li><p>搜索树通过二分的思想，每次过滤剩余数据的一半来提高效率。这就是数据结构的力量</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/3.%20%E6%90%9C%E7%B4%A2%E6%A0%91.webp title="3. 搜索树.webp"></p></li></ul></li></ol></li><li><p>对于 MySQL 的快速查询，最为关键的核心就是查询数据量少，越少越快。整篇文章均围绕该句进行展开。</p></li></ul><h2 id=没有索引是否一定会慢>没有索引是否一定会慢？</h2><ul><li>定义插入数据函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>      </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;用户id&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>biz_id</span><span class=w>  </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;业务id&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;业务信息&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>updated</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;用户&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=k>IN</span><span class=w> </span><span class=n>start_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>end_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>bizId</span><span class=w> </span><span class=nb>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>start_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WHILE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>end_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>DO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>biz_id</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>bizId</span><span class=p>,</span><span class=w> </span><span class=k>SUBSTRING</span><span class=p>(</span><span class=n>MD5</span><span class=p>(</span><span class=n>RAND</span><span class=p>()),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>准备数据若干，bizId 为 1 的只有两条，第一条和最后一条数据</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=c1>-- 插入第一条业务id1数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 插入一百万万条其他数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1000000</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 插入第二条业务id1数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertUserData</span><span class=p>(</span><span class=mi>1000001</span><span class=p>,</span><span class=w> </span><span class=mi>1000001</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>其实看数据分布，我想大家已经知道我想表达的，即便不使用索引。我们这里也是有快速查询的场景。</li></ul><p><strong>查询 limit1</strong></p><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 1;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ALL</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>997030</td><td style=text-align:left>10</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>10</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span><span class=mi>43</span><span class=p>]</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>97</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>92</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>10</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=mi>199</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=mi>172</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>27</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 2;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ALL</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>997030</td><td style=text-align:left>10</td><td style=text-align:left>Using where</td></tr></tbody></table><ul><li>从实际出发，我们可以看到，limit1 和 limit2 的执行时间相差巨大。</li><li>这里先分享一个技巧，我们可以使用 chatgpt 来高效整理分析 explain。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(文心一言)
</span></span><span class=line><span class=cl>这个查询计划显示了一个对user表的完整扫描，没有使用索引，并且WHERE子句用于筛选结果。
</span></span><span class=line><span class=cl>如果表很大或者查询的性能低，这可能会导致性能问题。
</span></span><span class=line><span class=cl>优化可能需要考虑使用合适的索引来提高查询性能。
</span></span></code></pre></td></tr></table></div></div><ul><li>我们可以看到，limit1 和 limi2 中，执行计划是几乎完全一致的。这个可以肯定，两次虽然时间相差巨大，但是对于 MySQL 来说执行逻辑相同。那为什么会相差巨大呢？就需要我们来具体分析。</li><li>在 limit1 的场景中，基于全表扫描，在第一条数据立即返回。等于仅查询了一条数据。</li><li>在 limit2 的场景中，第二条数据在百万条之后，所以根据执行计划，必须要扫描到全表才可以完整找到数据。</li><li>综上，没有索引就一定慢么？不一定的，索引仅仅是减少了数据查询量，但数据量本就极少的情况。是不会更慢的。</li></ul><h2 id=索引>索引</h2><ul><li>explain 里使用 where，根据 chatgpt 的回复，以及自己的分析。我们很自然地能想到索引来进行查询的优化。使用 B+树索引进行尝试。</li></ul><h3 id=b树索引>B+树索引</h3><blockquote><p><a href=https://www.cs.usfca.edu/~galles/visualization/Algorithms.html target=_blank rel="noopener noreffer">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 1;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>2</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>21</span><span class=p>:</span><span class=mi>09</span><span class=p>:</span><span class=mi>37</span><span class=p>]</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>44</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>EXPLAIN SELECT * FROM user WHERE biz_id = 1 LIMIT 2;</p></blockquote><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>2</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=mi>2023</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>27</span><span class=w> </span><span class=mi>21</span><span class=p>:</span><span class=mi>09</span><span class=p>:</span><span class=mi>04</span><span class=p>]</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>retrieved</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>48</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=p>(</span><span class=n>execution</span><span class=p>:</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=n>ms</span><span class=p>,</span><span class=w> </span><span class=n>fetching</span><span class=p>:</span><span class=w> </span><span class=mi>44</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>可以看到，增加索引之后，查询时间极大优化。执行计划从 where 进化为了使用 const</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=err>文心一言</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=err>在你的例子中，这个查询对名为</span><span class=s2>&#34;user&#34;</span><span class=err>的表进行查询</span>
</span></span><span class=line><span class=cl><span class=err>使用了名为</span><span class=s2>&#34;idx_user_biz_id&#34;</span><span class=err>的索引，索引长度为</span><span class=mi>8</span><span class=err>字节</span>
</span></span><span class=line><span class=cl><span class=err>比较列是常量（</span><span class=k>const</span><span class=err>），系统估算需要扫描</span><span class=mi>2</span><span class=err>行数据，返回的行占总行的</span><span class=mi>100</span><span class=o>%</span><span class=err>，没有其他额外信息。</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=为什么是-b树>为什么是 B+树</h4><p><strong>平衡二叉树</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/4.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91.png title="4. 平衡二叉树.png"></p><ul><li>在平衡二叉树中，我们可以思考一下查询的过程。</li><li>假设要查询 5~16 的所有数据。需要查询六个节点，且查出来的顺序非天然顺序排序，需要中序遍历的算法实现才可以。所以我们可以看到，平衡树是查找单个节点的天然数据结构，对于范围查询的支持相对较差</li><li>第一个待优化点，如果要细致理解，需要深入到磁盘预读取的优化。我认为理解必要不大，可以简单理解为 IO 次数过多<ul><li>平衡树，逻辑较近的地方，可能物理距离较远，导致在磁盘旋转操作中 IO 时间较长</li></ul></li><li>第二个待优化点，在 IO 读取数据时，会有过多的无用数据。因为读取数据回来必须大于单个节点数据的大小。</li><li>另外平衡二叉树，保持平衡需要旋转，在内存操作中比较难以高效实现</li></ul><p><strong>B 树</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/5.%20B%E6%A0%91.png title="5. B树.png"></p><ul><li>针对上述优化点，我们可以很自然地将<code>二叉</code>往<code>多叉</code>的方向优化，这样优化了单个节点过多无用数据的问题。因为单个节点较大的时候，IO 次数也降了下来</li><li>这样 B 树的思想可以很自然地出现。通过扩大节点形成多叉结构</li><li>但其实仔细想来，中序遍历算法的实现依然需要。对于范围查询仅优化在单个节点上，当范围跨度较大的时候，性能依然有可优化空间</li></ul><p><strong>B+树</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/6.%20B%2B%E6%A0%91.png title="6. B+树.png"></p><ul><li>B+树首先更加优化了单个节点的存储效率(没有了 Value)。这样单个节点可以支持的<code>叉</code>更多了</li><li>同时最底层的叶子节点通过指针组合成为链表，从而优化遍历逻辑。<ul><li>注: B+树的最底层是包含上层所有节点的</li></ul></li></ul><h3 id=b树联合索引>B+树联合索引</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png data-srcset="/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png 1.5x, /images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png 2x" data-sizes=auto alt=/images/3.%20%E6%B5%85%E8%B0%88MySQL%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2/7.%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png title="7. 联合索引.png"></p><ul><li>B+树的部分已经了解了，可以简单降之前的 B+树理解为聚簇索引，Value 在最底层的叶子节点</li><li>那么我们开始理解联合索引</li></ul><p><strong>最左匹配原则</strong></p><ul><li>具体原则，不需要讲述，理解即可</li></ul><p><strong>B+树索引为什么是排序的？</strong></p><ul><li>在上图中，我们一级索引是顺序的，这个很好理解，当一级索引固定时，其下的二级索引也是顺序的。</li><li>我的理解是，B+树先搜索一级索引。当一级索引确定后，B+树转化为二级索引的 B+树。依次类推<ul><li>注：联合索引在一颗树上</li></ul></li></ul><p><strong>B+树索引为什么失效？</strong></p><ul><li>首先我们可以理解一级索引为 1 的二级索引顺序和一级索引为 2 的二级索引顺序是没有必然先后顺序的。只是都具有相同的单调性而已</li><li>顺着我之前的索引数变化的方向去理解，当一级索引成为一个范围之后，二级索引不止一颗了，我们没有办法在多颗树上进行相同的范围单次查询。只能多次组合</li></ul><h4 id=什么是回表>什么是回表？</h4><ul><li>默认大家了解聚簇索引和二级索引</li><li>回表通俗地说就是，二级索引走完玩不下去了，比如之前的表</li><li>注: Type 表示访问类型的优化顺序，从最好到最差的顺序如下：system->const->eq_ref->ref->ref_or_null->index_merge->unique_subquery->index_subquery->range->index->all。一般来说，我们希望达到 ref 和 eq_ref 级别，范围查找需要达到 range 级别。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>      </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;用户id&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>biz_id</span><span class=w>  </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;业务id&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;业务信息&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>updated</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;用户&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>完全使用索引</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>498380</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>chatgpt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=err>查询语句涉及的表是</span><span class=s2>&#34;user&#34;</span><span class=err>表。</span>
</span></span><span class=line><span class=cl><span class=err>表的访问方式为</span><span class=s2>&#34;ref&#34;</span><span class=err>，表示使用了索引进行查询。</span>
</span></span><span class=line><span class=cl><span class=err>使用的索引为</span><span class=s2>&#34;idx_user_biz_id&#34;</span><span class=err>，并且查询使用了该索引。</span>
</span></span><span class=line><span class=cl><span class=err>使用的索引长度为</span><span class=mi>8</span><span class=err>个字节。</span>
</span></span><span class=line><span class=cl><span class=err>查询的参考值为</span><span class=s2>&#34;const&#34;</span><span class=err>，表示查询使用了一个常量值进行筛选。</span>
</span></span><span class=line><span class=cl><span class=err>查询返回的行数为</span><span class=mi>498380</span><span class=err>行，过滤率为</span><span class=mi>100</span><span class=o>%</span><span class=err>。</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Using index&#34;</span><span class=err>表示查询使用了覆盖索引，即查询结果可以直接从索引中获取，不需要再去访问表数据。</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>回表一次</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>498380</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(chatgpt)
</span></span><span class=line><span class=cl>该查询是一个简单的SELECT查询，没有子查询或联接。
</span></span><span class=line><span class=cl>查询引用了一个名为user的表。
</span></span><span class=line><span class=cl>查询使用了名为idx_user_biz_id的索引。
</span></span><span class=line><span class=cl>索引的长度为8。
</span></span><span class=line><span class=cl>查询使用了一个常量值进行参考。
</span></span><span class=line><span class=cl>查询扫描了498380行，并根据WHERE条件过滤了100行。
</span></span><span class=line><span class=cl>查询没有其他特殊情况。
</span></span></code></pre></td></tr></table></div></div><ul><li>回表一次(回表数据较多)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>idx_user_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>const</td><td style=text-align:left>498380</td><td style=text-align:left>10</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(chatgpt)
</span></span><span class=line><span class=cl>给定的查询是一个简单的SELECT查询，涉及到名为&#34;user&#34;的表。
</span></span><span class=line><span class=cl>查询使用了名为&#34;idx_user_biz_id&#34;的索引，并且使用了WHERE子句。
</span></span><span class=line><span class=cl>查询使用了普通的二级索引进行相等匹配。
</span></span><span class=line><span class=cl>查询返回了498380行的结果。
</span></span></code></pre></td></tr></table></div></div><p><strong>索引下推 & 覆盖索引</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_biz_id_msg</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>(</span><span class=n>biz_id</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>(</span><span class=mi>8</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;99dd8a31&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>const,const</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;99dd8a31&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>const,const</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>chatgpt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>type</span> <span class=err>字段表示查询的访问方式，从最优到最差的顺序依次是：</span><span class=n>system</span><span class=p>,</span> <span class=k>const</span><span class=p>,</span> <span class=n>eq_ref</span><span class=p>,</span> <span class=n>ref</span><span class=p>,</span> <span class=n>ref_or_null</span><span class=p>,</span> <span class=n>index_merge</span><span class=p>,</span> <span class=n>unique_subquery</span><span class=p>,</span> <span class=n>index_subquery</span><span class=p>,</span> <span class=nb>range</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>all</span><span class=err>。</span>
</span></span><span class=line><span class=cl><span class=n>possible_keys</span> <span class=err>列出可能有助于查询的索引，如果为空则表示没有可用的索引。</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=err>列出实际选择使用的索引，如果为</span> <span class=n>NULL</span> <span class=err>则表示没有使用索引。</span>
</span></span><span class=line><span class=cl><span class=n>Extra</span> <span class=err>列出额外的信息，例如</span> <span class=n>Using</span> <span class=n>where</span> <span class=err>表示使用了</span> <span class=n>WHERE</span> <span class=err>条件过滤。</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where; Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>10</td><td style=text-align:left>Using index condition; Using where</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>Using where; Using index; Using filesort</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>range</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>1</td><td style=text-align:left>10</td><td style=text-align:left>Using index condition; Using where; Using filesort</td></tr></tbody></table><h2 id=in-还是-exists>IN 还是 EXISTS？</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>task</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>      </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;用户id&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>biz_id</span><span class=w>  </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>                          </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;业务id&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;业务信息&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>updated</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;订单&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_task_biz_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>task</span><span class=p>(</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=k>IN</span><span class=w> </span><span class=n>start_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>end_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=n>bizId</span><span class=w> </span><span class=nb>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>start_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WHILE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>end_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>DO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>biz_id</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>bizId</span><span class=p>,</span><span class=w> </span><span class=k>SUBSTRING</span><span class=p>(</span><span class=n>MD5</span><span class=p>(</span><span class=n>RAND</span><span class=p>()),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 插入第一条业务id1数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 插入一百万万条其他数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 插入第二条业务id1数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span><span class=w> </span><span class=mi>11</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>13</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=w> </span><span class=mi>15</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>insertTaskData</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=分析>分析</h3><ul><li>小表驱动大表的原则</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>null</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>u</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>8</td><td style=text-align:left>test.task.biz_id</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:52] 1 row retrieved starting from 1 in 2 s 784 ms (execution: 2 s 766 ms, fetching: 18 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>u</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>null</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>t</td><td style=text-align:left>null</td><td style=text-align:left>ref</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>test.u.biz_id</td><td style=text-align:left>5</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>biz_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:57] 1 row retrieved starting from 1 in 4 s 527 ms (execution: 4 s 504 ms, fetching: 23 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.task.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:35] 1 row retrieved starting from 1 in 443 ms (execution: 399 ms, fetching: 44 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.user.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:58] 1 row retrieved starting from 1 in 545 ms (execution: 507 ms, fetching: 38 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.task.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=n>format</span><span class=o>=</span><span class=n>tree</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- -&gt; Aggregate: count(0)  (cost=3189638.65 rows=1)
</span></span></span><span class=line><span class=cl><span class=c1>--     -&gt; Nested loop inner join  (cost=1594821.05 rows=15948176)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Index scan on task using idx_task_biz_id  (cost=1.85 rows=16)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Single-row index lookup on &lt;subquery2&gt; using &lt;auto_distinct_key&gt; (biz_id=task.biz_id)
</span></span></span><span class=line><span class=cl><span class=c1>--             -&gt; Materialize with deduplication  (cost=202826.45..202826.45 rows=996761)
</span></span></span><span class=line><span class=cl><span class=c1>--                 -&gt; Index scan on user using idx_user_biz_id_msg  (cost=103150.35 rows=996761)
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:04:59] 1 row retrieved starting from 1 in 459 ms (execution: 421 ms, fetching: 38 ms)
</span></span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><table><thead><tr><th style=text-align:left>id</th><th style=text-align:left>select_type</th><th style=text-align:left>table</th><th style=text-align:left>partitions</th><th style=text-align:left>type</th><th style=text-align:left>possible_keys</th><th style=text-align:left>key</th><th style=text-align:left>key_len</th><th style=text-align:left>ref</th><th style=text-align:left>rows</th><th style=text-align:left>filtered</th><th style=text-align:left>Extra</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>user</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>idx_user_biz_id_msg</td><td style=text-align:left>43</td><td style=text-align:left>null</td><td style=text-align:left>996761</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr><tr><td style=text-align:left>1</td><td style=text-align:left>SIMPLE</td><td style=text-align:left>&lt;subquery2></td><td style=text-align:left>null</td><td style=text-align:left>eq_ref</td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>&lt;auto_distinct_key></td><td style=text-align:left>8</td><td style=text-align:left>test.user.biz_id</td><td style=text-align:left>1</td><td style=text-align:left>100</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>MATERIALIZED</td><td style=text-align:left>task</td><td style=text-align:left>null</td><td style=text-align:left>index</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>idx_task_biz_id</td><td style=text-align:left>8</td><td style=text-align:left>null</td><td style=text-align:left>16</td><td style=text-align:left>100</td><td style=text-align:left>Using index</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=n>format</span><span class=o>=</span><span class=n>tree</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- -&gt; Aggregate: count(0)  (cost=3392461.65 rows=1)
</span></span></span><span class=line><span class=cl><span class=c1>--     -&gt; Nested loop inner join  (cost=1797644.05 rows=15948176)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Index scan on user using idx_user_biz_id_msg  (cost=103150.35 rows=996761)
</span></span></span><span class=line><span class=cl><span class=c1>--         -&gt; Single-row index lookup on &lt;subquery2&gt; using &lt;auto_distinct_key&gt; (biz_id=`user`.biz_id)
</span></span></span><span class=line><span class=cl><span class=c1>--             -&gt; Materialize with deduplication  (cost=3.45..3.45 rows=16)
</span></span></span><span class=line><span class=cl><span class=c1>--                 -&gt; Index scan on task using idx_task_biz_id  (cost=1.85 rows=16)
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(chatgpt)
</span></span><span class=line><span class=cl>在第一个查询中，系统首先在task表上执行索引扫描，扫描的索引为idx_task_biz_id。
</span></span><span class=line><span class=cl>然后在子查询&lt;subquery2&gt;上执行单行索引查找，查找的键为biz_id=task.biz_id。
</span></span><span class=line><span class=cl>这是一个典型的嵌套循环连接，系统会获取task表的一行数据，然后在子查询&lt;subquery2&gt;中搜索这一行数据。
</span></span><span class=line><span class=cl>这个过程会一直持续到task表的所有行都在子查询&lt;subquery2&gt;中被搜索过sqlshack.com。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>在第二个查询中，系统首先在user表上执行索引扫描，扫描的索引为idx_user_biz_id_msg。
</span></span><span class=line><span class=cl>然后在子查询&lt;subquery2&gt;上执行单行索引查找，查找的键为biz_id=user.biz_id。
</span></span><span class=line><span class=cl>这个查询的执行过程类似于第一个查询，不过这次是从user表开始。
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>biz_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=p>.</span><span class=n>biz_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>task</span><span class=p>.</span><span class=n>biz_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- [2023-08-30 10:05:00] 1 row retrieved starting from 1 in 567 ms (execution: 523 ms, fetching: 44 ms)
</span></span></span></code></pre></td></tr></table></div></div><ul><li>查询的资料里，反复强调的是小表驱动数据量比大表驱动数据量要少。对于此，其实我是不太能接受。无论小表还是大表驱动，最终的数据量应是相同才对，不然结果不会不同，而且数学上 10 * 10000 和 10000 * 10 得出的数据量应相同。</li><li>不过 IO 确实有差距，大表驱动，会依照大表进行 IO 和索引查询操作。</li></ul><p>Reference</p><ol><li><a href=http://blog.codinglabs.org/articles/theory-of-mysql-index.html target=_blank rel="noopener noreffer">MySQL 索引背后的数据结构及算法原理</a></li><li><a href=https://blog.csdn.net/qq_43352723/article/details/120516281 target=_blank rel="noopener noreffer">(MySQL)简单易懂的 B+树索引介绍</a></li><li><a href="https://www.xjx100.cn/news/311647.html?action=onClick" target=_blank rel="noopener noreffer">MySQL 之 B+树索引的使用</a></li><li><a href=https://blog.csdn.net/qq_44918090/article/details/120278339 target=_blank rel="noopener noreffer">B 树与 B+树的区别</a></li><li><a href=https://blog.csdn.net/zhibo_lv/article/details/117846795 target=_blank rel="noopener noreffer">MySQL 实战—— Limit 与 Order by 对查询效率的巨大影响</a></li><li><a href=https://zhuanlan.zhihu.com/p/380671457 target=_blank rel="noopener noreffer">看一遍就理解：order by 详解</a></li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-10-02&nbsp;<a class=git-hash href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io/commit/2e18c300b2ee848f2953b2e4671d9a9d358d100f target=_blank title="commit by haotian(haotian@codemao.cn) 2e18c300b2ee848f2953b2e4671d9a9d358d100f: Enhance bilingual support and content structure in documentation">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>2e18c30</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/zh-cn/2025/09/3.-mysql-fast-query-insights/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. 浅谈 MySQL 快速查询" data-hashtags=MySQL,index,database,optimization><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/ data-hashtag=MySQL><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. 浅谈 MySQL 快速查询"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. 浅谈 MySQL 快速查询"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://gooddayday.github.io/zh-cn/2025/09/3.-mysql-fast-query-insights/ data-title="[MySQL] 1. 浅谈 MySQL 快速查询"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/zh-cn/tags/mysql/>MySQL</a>,&nbsp;<a href=/zh-cn/tags/index/>Index</a>,&nbsp;<a href=/zh-cn/tags/database/>Database</a>,&nbsp;<a href=/zh-cn/tags/optimization/>Optimization</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/zh-cn/>主页</a></span></section></div><div class=post-nav><a href=/zh-cn/2025/09/2.-file-transfer-optimization/ class=prev rel=prev title="[Network] 1. 文件传输优化分享"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>[Network] 1. 文件传输优化分享</a>
<a href=/zh-cn/2025/09/4.-lombok/ class=next rel=next title="[Java] 1. Lombok">[Java] 1. Lombok<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><span class=author itemprop=copyrightHolder>&nbsp;<a href=/zh-cn/ target=_blank>GoodyHao</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/css/auto-numbering.css><link rel=stylesheet href=/css/svg-fullwidth.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"DIC_kwDOPtWtCc4CvteQ",darkTheme:"dark",emitMetadata:"0",inputPosition:"bottom",lang:"zh-CN",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"GOODDAYDAY/GOODDAYDAY.github.io",repoId:"R_kgDOPtWtCQ"}},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.zh-cn",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>