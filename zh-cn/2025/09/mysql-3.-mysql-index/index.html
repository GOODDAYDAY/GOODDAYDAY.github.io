<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[MySQL] 3. MySQL 索引 - GoodyHao's Blog</title><meta name=Description content="Elegance Never Fades"><meta property="og:url" content="https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/"><meta property="og:site_name" content="GoodyHao's Blog"><meta property="og:title" content="[MySQL] 3. MySQL 索引"><meta property="og:description" content="什么是索引？ 索引是一种数据结构，通过额外的写入和存储空间来维护索引数据结构，从而提高数据库表上数据检索操作的速度。 索引类型 按数据结构分类 哈希索引 哈希索引基于哈希表数据结构。它使用哈希函数将键映射到哈希表中的特定位置，允许非常快速的数据检索。 算法复杂度：O(1) 优点： 对等值查询（如 =）非常快。 缺点： 不适合范围查询（如 <、>、BETWEEN）。 可能发生哈希冲突，导致性能下降。 为什么不支持 order by 让我们看看哈希索引的算法"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-28T21:02:17+08:00"><meta property="article:modified_time" content="2025-12-06T22:29:56+08:00"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="Index"><meta property="og:image" content="https://gooddayday.github.io/logo.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gooddayday.github.io/logo.jpg"><meta name=twitter:title content="[MySQL] 3. MySQL 索引"><meta name=twitter:description content="什么是索引？ 索引是一种数据结构，通过额外的写入和存储空间来维护索引数据结构，从而提高数据库表上数据检索操作的速度。 索引类型 按数据结构分类 哈希索引 哈希索引基于哈希表数据结构。它使用哈希函数将键映射到哈希表中的特定位置，允许非常快速的数据检索。 算法复杂度：O(1) 优点： 对等值查询（如 =）非常快。 缺点： 不适合范围查询（如 <、>、BETWEEN）。 可能发生哈希冲突，导致性能下降。 为什么不支持 order by 让我们看看哈希索引的算法"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/><link rel=prev href=https://gooddayday.github.io/zh-cn/2025/09/mysql-2.-mysql-lock/><link rel=next href=https://gooddayday.github.io/zh-cn/2025/10/spring-2.-spring-async-threadpool-and-thread-reuse/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[MySQL] 3. MySQL 索引","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/gooddayday.github.io\/zh-cn\/2025\/09\/mysql-3.-mysql-index\/"},"image":["https:\/\/gooddayday.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"MySQL, Index","wordcount":3493,"url":"https:\/\/gooddayday.github.io\/zh-cn\/2025\/09\/mysql-3.-mysql-index\/","datePublished":"2025-09-28T21:02:17+08:00","dateModified":"2025-12-06T22:29:56+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/gooddayday.github.io\/images\/logo.jpg"},"author":{"@type":"Person","name":"GoodyHao"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/zh-cn/ title="GoodyHao's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Elegance Never Fades</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/zh-cn/posts/>所有文章 </a><a class=menu-item href=/zh-cn/tags/>标签 </a><a class=menu-item href=/zh-cn/categories/>分类 </a><a class=menu-item href=/zh-cn/categories/documentation/>文档 </a><a class=menu-item href=/zh-cn/about/>关于 </a><a class=menu-item href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a class=menu-item href=/en/2025/09/mysql-3.-mysql-index/ title=English>English</a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/zh-cn/ title="GoodyHao's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Elegance Never Fades</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/zh-cn/posts/ title>所有文章</a><a class=menu-item href=/zh-cn/tags/ title>标签</a><a class=menu-item href=/zh-cn/categories/ title>分类</a><a class=menu-item href=/zh-cn/categories/documentation/ title>文档</a><a class=menu-item href=/zh-cn/about/ title>关于</a><a class=menu-item href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a class=menu-item href=/en/2025/09/mysql-3.-mysql-index/ title=English>English</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[MySQL] 3. MySQL 索引</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/zh-cn/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>GoodyHao</a></span>&nbsp;<span class=post-category>收录于 <a href=/zh-cn/categories/mysql/><i class="far fa-folder fa-fw" aria-hidden=true></i>MySQL</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-09-28>2025-09-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 3493 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 7 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#什么是索引>什么是索引？</a></li><li><a href=#索引类型>索引类型</a><ul><li><a href=#按数据结构分类>按数据结构分类</a><ul><li><a href=#哈希索引>哈希索引</a><ul><li><a href=#为什么不支持-order-by>为什么不支持 <code>order by</code></a></li></ul></li><li><a href=#btreeb-tree-索引>BTree(B-Tree) 索引</a><ul><li><a href=#为什么不用-avl-或红黑树>为什么不用 AVL 或红黑树</a></li><li><a href=#为什么选择-btree>为什么选择 BTree</a></li></ul></li><li><a href=#btree-索引>B+Tree 索引</a></li></ul></li><li><a href=#按用途分类>按用途分类</a><ul><li><a href=#主键索引>主键索引</a></li><li><a href=#复合索引>复合索引</a></li><li><a href=#二级索引非聚集索引>二级索引（非聚集索引）</a><ul><li><a href=#覆盖索引-vs-回表>覆盖索引 vs 回表</a></li><li><a href=#回表过程>回表过程</a></li></ul></li><li><a href=#全文索引>全文索引</a><ul><li><a href=#与-btree-索引的关键区别>与 B+Tree 索引的关键区别</a></li><li><a href=#倒排索引机制>倒排索引机制</a></li><li><a href=#支持的数据类型>支持的数据类型</a></li><li><a href=#创建表语法>创建表语法</a></li><li><a href=#搜索模式>搜索模式</a><ul><li><a href=#自然语言模式默认>自然语言模式（默认）</a></li><li><a href=#布尔模式>布尔模式</a></li></ul></li></ul></li></ul></li></ul></li><li><a href=#高级索引优化概念>高级索引优化概念</a><ul><li><a href=#表结构和索引>表结构和索引</a></li><li><a href=#覆盖索引>覆盖索引</a><ul><li><a href=#非覆盖索引为其他列返回而回表>非覆盖索引：为其他列返回而回表</a></li><li><a href=#非覆盖索引为其他列作为条件而回表>非覆盖索引：为其他列作为条件而回表</a></li><li><a href=#覆盖索引成功>覆盖索引成功</a></li></ul></li><li><a href=#索引条件下推>索引条件下推</a><ul><li><a href=#非-icp只有一个条件>非 ICP：只有一个条件</a></li><li><a href=#icp-成功>ICP 成功</a></li></ul></li><li><a href=#回表>回表</a><ul><li><a href=#回表返回更多列>回表：返回更多列</a></li><li><a href=#回表条件包含更多列>回表：条件包含更多列</a></li><li><a href=#不回表好>不回表（好）</a></li></ul></li></ul></li><li><a href=#索引使用经验>索引使用经验</a><ul><li><a href=#何时使用哈希索引>何时使用哈希索引</a></li><li><a href=#过滤率是索引使用的关键点>过滤率是索引使用的关键点</a><ul><li><a href=#经典问题id-begin-end-vs-id-end-begin>经典问题：(id, begin, end) vs (id, end, begin)</a><ul><li><a href=#查找活跃优惠券>查找活跃优惠券</a></li></ul></li><li><a href=#经典问题类型索引>经典问题：类型索引</a><ul><li><a href=#几乎平均如计算机类型>几乎平均，如计算机类型</a></li><li><a href=#不平均如支付状态>不平均，如支付状态</a></li></ul></li></ul></li><li><a href=#数据大小-vs-索引大小>数据大小 VS 索引大小</a></li><li><a href=#不要频繁修改索引列>不要频繁修改索引列</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=什么是索引>什么是索引？</h2><ul><li>索引是一种数据结构，通过额外的写入和存储空间来维护索引数据结构，从而提高数据库表上数据检索操作的速度。</li></ul><h2 id=索引类型>索引类型</h2><h3 id=按数据结构分类>按数据结构分类</h3><h4 id=哈希索引>哈希索引</h4><ul><li>哈希索引基于哈希表数据结构。它使用哈希函数将键映射到哈希表中的特定位置，允许非常快速的数据检索。</li><li>算法复杂度：O(1)</li><li>优点：<ul><li>对等值查询（如 <code>=</code>）非常快。</li></ul></li><li>缺点：<ul><li>不适合范围查询（如 <code>&lt;</code>、<code>></code>、<code>BETWEEN</code>）。</li><li>可能发生哈希冲突，导致性能下降。</li></ul></li></ul><h5 id=为什么不支持-order-by>为什么不支持 <code>order by</code></h5><ul><li>让我们看看哈希索引的算法</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/6.%20hash%20function.svg data-srcset="/images/13.%20mysql%20index/6.%20hash%20function.svg, /images/13.%20mysql%20index/6.%20hash%20function.svg 1.5x, /images/13.%20mysql%20index/6.%20hash%20function.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/6.%20hash%20function.svg title="6. hash function.svg"></p><ul><li>我们看到哈希索引是键值结构。因此值不是有序的，所以它不能支持 <code>order by</code>。</li></ul><h4 id=btreeb-tree-索引>BTree(B-Tree) 索引</h4><h5 id=为什么不用-avl-或红黑树>为什么不用 AVL 或红黑树</h5><ul><li>对于树索引，我们可以考虑平衡搜索树，如 AVL 树或红黑树<ul><li>算法复杂度：O(log n)</li></ul></li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/4.%20AVL.svg data-srcset="/images/13.%20mysql%20index/4.%20AVL.svg, /images/13.%20mysql%20index/4.%20AVL.svg 1.5x, /images/13.%20mysql%20index/4.%20AVL.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/4.%20AVL.svg title="4. AVL.svg"> <img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/5.%20Red-Black.svg data-srcset="/images/13.%20mysql%20index/5.%20Red-Black.svg, /images/13.%20mysql%20index/5.%20Red-Black.svg 1.5x, /images/13.%20mysql%20index/5.%20Red-Black.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/5.%20Red-Black.svg title="5. Red-Black.svg"></p><ul><li>显然，它们是二叉平衡搜索树，不适合数据库索引，因为：<ul><li>树高度高：二叉树可能变得很高，导致搜索时间增加。</li><li>频繁重新平衡：插入和删除操作经常需要树旋转来维护平衡，这在性能方面代价很高。</li><li>磁盘 I/O 性能差：二叉树不利用空间局部性，导致低效的磁盘访问模式。<ul><li>磁盘 I/O 的成本远高于内存访问。</li></ul></li></ul></li></ul><h5 id=为什么选择-btree>为什么选择 BTree</h5><ul><li>因此，为了减少树高度和磁盘 I/O，BTree 自然而然地出现了。<ul><li>首先，使用多路树来减少树高度。</li><li>其次，每个节点包含整个磁盘页数据以减少磁盘 I/O。</li></ul></li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/3.%20btree_index.svg data-srcset="/images/13.%20mysql%20index/3.%20btree_index.svg, /images/13.%20mysql%20index/3.%20btree_index.svg 1.5x, /images/13.%20mysql%20index/3.%20btree_index.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/3.%20btree_index.svg title="3. btree_index.svg"></p><ul><li>但我们仍然有一些问题：<ul><li>当我们插入或删除数据时，树可能变得不平衡。</li><li>很难按顺序搜索，我们需要使用中序遍历，成本很高，才能获得排序数据。</li><li>所以，B+Tree 出现了。</li></ul></li></ul><h4 id=btree-索引>B+Tree 索引</h4><ul><li>首先，B+Tree 通过只在内部节点中存储键来减少树节点大小，这允许更多键适合内存并减少树高度。<ul><li>没有值意味着一个节点中有更多键 => 更少的树高度 => 更少的磁盘 I/O</li></ul></li><li>其次，B+Tree 将所有实际数据存储在叶节点中，这些节点在链表中链接在一起，使范围查询更高效。</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/1.%20single_index.svg data-srcset="/images/13.%20mysql%20index/1.%20single_index.svg, /images/13.%20mysql%20index/1.%20single_index.svg 1.5x, /images/13.%20mysql%20index/1.%20single_index.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/1.%20single_index.svg title="1. single_index.svg"></p><h3 id=按用途分类>按用途分类</h3><h4 id=主键索引>主键索引</h4><ul><li>主键索引是为主键列自动创建的。如果没有主键，MySQL 会创建一个。</li><li>确保唯一性和快速访问记录，因为只有一个操作就能获得整个记录。</li><li>主键是 B+Tree</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/2.%20composite_index.svg data-srcset="/images/13.%20mysql%20index/2.%20composite_index.svg, /images/13.%20mysql%20index/2.%20composite_index.svg 1.5x, /images/13.%20mysql%20index/2.%20composite_index.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/2.%20composite_index.svg title="2. composite_index.svg"></p><h4 id=复合索引>复合索引</h4><ul><li>我们知道 MySQL 支持复合索引，即多个列上的索引。</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/2.%20composite_index.svg data-srcset="/images/13.%20mysql%20index/2.%20composite_index.svg, /images/13.%20mysql%20index/2.%20composite_index.svg 1.5x, /images/13.%20mysql%20index/2.%20composite_index.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/2.%20composite_index.svg title="2. composite_index.svg"></p><ul><li><p>让我们看看单个叶页。</p><ul><li>叶页首先按第一列排序，然后按第二列排序。<ul><li>{列 A，列 B}：(1, 1), (1, 2), (2, 1), (2, 2), (3, 1), (3, 2)</li></ul></li></ul></li><li><p>所以，让我们思考经典问题：（最左前缀规则）</p><ul><li>如果我们在 (A, B) 上有复合索引，我们能将其用于查询 <code>where B = 1</code> 吗？<ul><li>不能，因为叶页首先按 A 排序，然后按 B 排序。所以我们不能快速找到所有 B = 1。</li></ul></li><li>如果我们在 (A, B) 上有复合索引，我们能将其用于查询 <code>where A = 1 AND B > 1</code> 吗？<ul><li>可以，因为我们可以快速找到 A = 1，然后我们得到 <code>(1, 1), (1, 2)</code>，这意味着 B 是有序的，所以我们可以快速找到 B > 1。</li></ul></li><li>如果我们在 (A, B) 上有复合索引，我们能将其用于查询 <code>where A > 1 AND B > 1</code> 吗？<ul><li>可以，但只有 A > 1 被使用。因为我们将得到 <code>(2, 1), (2, 2), (3, 1), (3, 2)</code>，这意味着 B 不是有序的。</li></ul></li></ul></li></ul><h4 id=二级索引非聚集索引>二级索引（非聚集索引）</h4><ul><li>二级索引也称为非聚集索引，与聚集索引（主键索引）不同。</li><li><strong>关键区别</strong>：二级索引叶节点只存储<strong>索引列 + 主键值</strong>，不存储完整的行数据。</li><li><strong>索引结构</strong>：B+Tree 结构，但叶节点包含对主键的引用而不是完整行数据。</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/8.%20secondary_index.svg data-srcset="/images/13.%20mysql%20index/8.%20secondary_index.svg, /images/13.%20mysql%20index/8.%20secondary_index.svg 1.5x, /images/13.%20mysql%20index/8.%20secondary_index.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/8.%20secondary_index.svg title="8. secondary_index.svg"></p><h5 id=覆盖索引-vs-回表>覆盖索引 vs 回表</h5><ul><li><p><strong>覆盖索引</strong>：当查询字段都包含在二级索引中时，无需回表。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 索引：idx_AB (A, B)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>  </span><span class=c1>-- ✅ 覆盖索引，无需回表
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>回表</strong>：当查询需要不在二级索引中的字段时，必须查找主键。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 索引：idx_AB (A, B)，但需要字段 C
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>  </span><span class=c1>-- ❌ 需要为字段 C 回表
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h5 id=回表过程>回表过程</h5><ol><li><strong>搜索二级索引</strong>：找到匹配记录，获取主键值</li><li><strong>查找主索引</strong>：使用主键从聚集索引获取完整行数据</li><li><strong>返回结果</strong>：合并来自两个索引的数据</li></ol><p>这就是为什么 <code>SELECT *</code> 经常需要回表，而只选择索引列可以避免回表。</p><h4 id=全文索引>全文索引</h4><ul><li>全文索引设计用于解决在大文本中查找单词的问题，使用<strong>倒排索引</strong>结构。</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/13.%20mysql%20index/7.%20fulltext_index-Full_Text_Index.svg data-srcset="/images/13.%20mysql%20index/7.%20fulltext_index-Full_Text_Index.svg, /images/13.%20mysql%20index/7.%20fulltext_index-Full_Text_Index.svg 1.5x, /images/13.%20mysql%20index/7.%20fulltext_index-Full_Text_Index.svg 2x" data-sizes=auto alt=/images/13.%20mysql%20index/7.%20fulltext_index-Full_Text_Index.svg title="7. fulltext_index-Full_Text_Index.svg"></p><h5 id=与-btree-索引的关键区别>与 B+Tree 索引的关键区别</h5><table><thead><tr><th>特性</th><th>B+Tree 索引</th><th>全文索引</th></tr></thead><tbody><tr><td><strong>数据结构</strong></td><td>平衡树</td><td>倒排索引（单词 → 文档）</td></tr><tr><td><strong>存储</strong></td><td>叶子中的完整行数据</td><td>单词到文档的映射</td></tr><tr><td><strong>查询类型</strong></td><td>精确匹配，范围查询</td><td>文本搜索，相关性排名</td></tr><tr><td><strong>复杂度</strong></td><td>O(log n)</td><td>取决于单词频率</td></tr></tbody></table><h5 id=倒排索引机制>倒排索引机制</h5><ol><li><strong>分词</strong>：将文本分解为单个单词</li><li><strong>单词映射</strong>：创建单词 → 文档列表映射</li><li><strong>搜索过程</strong>：查找包含查询单词的文档</li><li><strong>交集</strong>：为多词查询合并结果</li></ol><h5 id=支持的数据类型>支持的数据类型</h5><ul><li><code>CHAR</code></li><li><code>VARCHAR</code></li><li><code>TEXT</code></li></ul><h5 id=创建表语法>创建表语法</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 单列全文索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>title</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>content</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>FULLTEXT</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>ft_content</span><span class=w> </span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 多列全文索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>title</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>content</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>FULLTEXT</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>ft_title_content</span><span class=w> </span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=搜索模式>搜索模式</h5><h6 id=自然语言模式默认>自然语言模式（默认）</h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>MATCH</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=n>AGAINST</span><span class=p>(</span><span class=s1>&#39;MySQL 优化&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 带相关性评分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=k>MATCH</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=n>AGAINST</span><span class=p>(</span><span class=s1>&#39;MySQL 优化&#39;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>score</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>MATCH</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=n>AGAINST</span><span class=p>(</span><span class=s1>&#39;MySQL 优化&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h6 id=布尔模式>布尔模式</h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 必须包含&#34;MySQL&#34;，不能包含&#34;Oracle&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>MATCH</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=n>AGAINST</span><span class=p>(</span><span class=s1>&#39;+MySQL -Oracle&#39;</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>MODE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 精确短语搜索
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>MATCH</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=n>AGAINST</span><span class=p>(</span><span class=s1>&#39;&#34;索引优化&#34;&#39;</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>MODE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 通配符搜索
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>MATCH</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=n>AGAINST</span><span class=p>(</span><span class=s1>&#39;优化*&#39;</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>MODE</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=高级索引优化概念>高级索引优化概念</h2><p>让我们分析各种 SQL 查询，以了解<strong>覆盖索引</strong>、<strong>索引条件下推（ICP）<strong>和</strong>回表</strong>行为。</p><h3 id=表结构和索引>表结构和索引</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>B</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>C</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>D</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 在列 A, B, C 上的复合索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_articles_query</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>索引结构</strong>：<code>idx_articles_query (A, B, C)</code>（二级索引）+ 主键 <code>id</code>（自动包含在二级索引中）</p><h3 id=覆盖索引>覆盖索引</h3><ul><li><strong>覆盖索引</strong>：当所有查询列都包含在索引中时，消除回表需求。</li><li>所以，如果查询需要回表，它就不能是<code>覆盖索引</code></li></ul><h4 id=非覆盖索引为其他列返回而回表>非覆盖索引：为其他列返回而回表</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=非覆盖索引为其他列作为条件而回表>非覆盖索引：为其他列作为条件而回表</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=覆盖索引成功>覆盖索引成功</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=索引条件下推>索引条件下推</h3><p><strong>ICP</strong>：将可以使用索引的 WHERE 条件下推到存储引擎层，减少回表。</p><h4 id=非-icp只有一个条件>非 ICP：只有一个条件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=icp-成功>ICP 成功</h4><p><strong>即使跳过一个索引列</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>即使有其他索引列</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>正常情况</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=回表>回表</h3><ul><li>二级索引只保存 <code>id</code>，如果有其他列，就会发生回表。</li><li>回表是我们<code>需要避免</code>的操作。因为它代价更高。</li></ul><h4 id=回表返回更多列>回表：返回更多列</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=回表条件包含更多列>回表：条件包含更多列</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>D</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=不回表好>不回表（好）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>id 包含在二级索引叶节点中</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>articles</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=索引使用经验>索引使用经验</h2><h3 id=何时使用哈希索引>何时使用哈希索引</h3><ol><li>只搜索<code>一个</code>图片。</li><li>列内容几乎随机或不相关，如 UUID。</li></ol><h3 id=过滤率是索引使用的关键点>过滤率是索引使用的关键点</h3><ol><li>如果可重用，索引应该更少。</li><li>索引设计的要点是更高的过滤率。</li></ol><h4 id=经典问题id-begin-end-vs-id-end-begin>经典问题：(id, begin, end) vs (id, end, begin)</h4><ul><li>优惠券表</li></ul><table><thead><tr><th style=text-align:center>user_id</th><th>begin</th><th>end</th></tr></thead><tbody><tr><td style=text-align:center>~</td><td>~</td><td>~</td></tr><tr><td style=text-align:center>7</td><td>1234567890000</td><td>1234567890100</td></tr><tr><td style=text-align:center>7</td><td>1234567891000</td><td>1234567891100</td></tr><tr><td style=text-align:center>7</td><td>1234567892000</td><td>1234567892100</td></tr><tr><td style=text-align:center>7</td><td>1234567893000</td><td>1234567893100</td></tr><tr><td style=text-align:center>7</td><td>1234567894000</td><td>1234567894100</td></tr><tr><td style=text-align:center>7</td><td>1234567895000</td><td>1234567895100</td></tr><tr><td style=text-align:center>7</td><td>1234567896000</td><td>1234567896100</td></tr><tr><td style=text-align:center>7</td><td>1234567897000</td><td>1234567897100</td></tr><tr><td style=text-align:center>7</td><td>1234567898000</td><td>1234567898100</td></tr><tr><td style=text-align:center>~</td><td>~</td><td>~</td></tr></tbody></table><h5 id=查找活跃优惠券>查找活跃优惠券</h5><ul><li>让我们分析如果我们搜索下面的 SQL。<ul><li>SELECT * FROM <code>table</code> WHERE id = 7 AND begin &lt; 1234567894000 AND end > 1234567894000</li></ul></li></ul><ol><li><code>索引条件下推</code>可以用于此查询。</li><li>只有<code>前两列索引</code>可以使用，即 (id, begin, end) 中的 (id, begin) 或 (id, end, begin) 中的 (id, end)。</li><li>但是，对于 (id, begin) 部分，begin > 1234567894000 总是过滤更少的数据，时间总是<code>现在</code>。</li></ol><ul><li>因为总有数据时间比现在小。</li></ul><ol start=4><li>对于 (id, end) 部分，end > 1234567894000 总是能过滤更多的数据。</li></ol><blockquote><p>所以更好的是 (id, end, begin)</p></blockquote><h4 id=经典问题类型索引>经典问题：类型索引</h4><ul><li>假设有 5 种类型</li></ul><h5 id=几乎平均如计算机类型>几乎平均，如计算机类型</h5><ul><li>INDEX idx_computer_type(type)</li><li>在这种情况下，当我们使用 type = 1 时，只有大约 20% 的过滤率。</li></ul><h5 id=不平均如支付状态>不平均，如支付状态</h5><ul><li>INDEX idx_payment_status(status)</li><li>在这种情况下，几乎所有支付都将是 status = final。</li><li><code>但是</code>我们总是查询 status != final，它只占很少的数据，少于 1%（接近超过 99% 的过滤率）。</li></ul><h3 id=数据大小-vs-索引大小>数据大小 VS 索引大小</h3><ul><li>人们总是认为如果数据只是一点点，就不需要创建索引。</li><li>当数据不大时，有很多索引也没关系。<ul><li>因为索引不会使用太多存储。</li></ul></li><li>当数据很大时，有很多索引也没关系。<ul><li>因为索引对我们快速查询很重要。</li></ul></li></ul><h3 id=不要频繁修改索引列>不要频繁修改索引列</h3><ul><li>我们知道索引是平衡和有序的。如果我们修改索引列值，B+Tree 需要重新平衡自己，这代价很高。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-12-06&nbsp;<a class=git-hash href=https://github.com/GOODDAYDAY/GOODDAYDAY.github.io/commit/af3d5c9bd409e602f90f3dec7c5441cd7924d96f target=_blank title="commit by haotian(865700600@qq.com) af3d5c9bd409e602f90f3dec7c5441cd7924d96f: Refactor Redis Cluster documentation for clarity and consistency">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>af3d5c9</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/zh-cn/2025/09/mysql-3.-mysql-index/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/ data-title="[MySQL] 3. MySQL 索引" data-hashtags=MySQL,Index><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/ data-hashtag=MySQL><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/ data-title="[MySQL] 3. MySQL 索引"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/ data-title="[MySQL] 3. MySQL 索引"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://gooddayday.github.io/zh-cn/2025/09/mysql-3.-mysql-index/ data-title="[MySQL] 3. MySQL 索引"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/zh-cn/tags/mysql/>MySQL</a>,&nbsp;<a href=/zh-cn/tags/index/>Index</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/zh-cn/>主页</a></span></section></div><div class=post-nav><a href=/zh-cn/2025/09/mysql-2.-mysql-lock/ class=prev rel=prev title="[MySQL] 2. 锁机制执行分析"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>[MySQL] 2. 锁机制执行分析</a>
<a href=/zh-cn/2025/10/spring-2.-spring-async-threadpool-and-thread-reuse/ class=next rel=next title="[Spring] 2. 浅谈Spring异步接口中的自定义线程池与线程复用分析">[Spring] 2. 浅谈Spring异步接口中的自定义线程池与线程复用分析<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><span class=author itemprop=copyrightHolder>&nbsp;<a href=/zh-cn/ target=_blank>GoodyHao</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><link rel=stylesheet href=/css/auto-numbering.css><link rel=stylesheet href=/css/svg-fullwidth.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"DIC_kwDOPtWtCc4CvteQ",darkTheme:"dark",emitMetadata:"0",inputPosition:"bottom",lang:"zh-CN",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"GOODDAYDAY/GOODDAYDAY.github.io",repoId:"R_kgDOPtWtCQ"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.zh-cn",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>